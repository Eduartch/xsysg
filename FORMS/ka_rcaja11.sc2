*--------------------------------------------------------------------------------------------------------------------------------------------------------
* (ES) AUTOGENERADO - ¡¡ATENCIÓN!! - ¡¡NO PENSADO PARA EJECUTAR!! USAR SOLAMENTE PARA INTEGRAR CAMBIOS Y ALMACENAR CON HERRAMIENTAS SCM!!
* (EN) AUTOGENERATED - ATTENTION!! - NOT INTENDED FOR EXECUTION!! USE ONLY FOR MERGING CHANGES AND STORING WITH SCM TOOLS!!
*--------------------------------------------------------------------------------------------------------------------------------------------------------
*< FOXBIN2PRG: Version="1.19" SourceFile="ka_rcaja11.scx" /> (Solo para binarios VFP 9 / Only for VFP 9 binaries)
*
*
#INCLUDE "..\include\sisfotos.h"

DEFINE CLASS dataenvironment AS dataenvironment 
 	*< CLASSDATA: Baseclass="dataenvironment" Timestamp="" Scale="" Uniqueid="" ClassIcon="2" />

	DataSource = .NULL.
	Height = 200
	Left = 1
	Name = "Dataenvironment"
	Top = 220
	Width = 520

ENDDEFINE

DEFINE CLASS forliquida AS form 
 	*< CLASSDATA: Baseclass="form" Timestamp="" Scale="" Uniqueid="" />

	*-- OBJECTDATA items order determines ZOrder / El orden de los items OBJECTDATA determina el ZOrder 
	*< OBJECTDATA: ObjPath="Container1" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Label1" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Cmdimprimir" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Cmdvistaprevia" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Cmdconsulta" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Cmdaexcel1" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Txtfecha" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Grimodelos" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Cmbturno" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="cmbusuario" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Cmbisla" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="chkturno" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Chkusuario" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="chkisla" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Txtlocalizador1" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="LBL1" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Cmdconsulta2" UniqueID="" Timestamp="" />

	*<DefinedPropArrayMethod>
		*p: almacen
	*</DefinedPropArrayMethod>

	AutoCenter = .T.
	BorderStyle = 1
	Caption = "[Informe Caja ]"
	ControlBox = .T.
	DataSession = 2
	DoCreate = .T.
	FontName = "Tahoma"
	Height = 560
	Icon = ..\graphics\anular.ico
	MaxButton = .F.
	MinButton = .T.
	Movable = .T.
	Name = "forliquida"
	Picture = ..\graphics\fondoazul.jpg
	ShowWindow = 1
	Width = 1164
	WindowState = 0
	WindowType = 0

	ADD OBJECT 'chkisla' AS checkbox WITH ;
		Alignment = 0, ;
		BackColor = 128,128,128, ;
		BackStyle = 0, ;
		Caption = "Isla", ;
		FontBold = .T., ;
		FontName = "Tahoma", ;
		FontSize = 8, ;
		ForeColor = 0,0,0, ;
		Height = 13, ;
		Left = 445, ;
		Name = "chkisla", ;
		TabIndex = 2, ;
		Top = 20, ;
		Width = 56
		*< END OBJECT: BaseClass="checkbox" />

	ADD OBJECT 'chkturno' AS checkbox WITH ;
		Alignment = 0, ;
		BackColor = 128,128,128, ;
		BackStyle = 0, ;
		Caption = "Turno", ;
		FontBold = .T., ;
		FontName = "Tahoma", ;
		FontSize = 8, ;
		ForeColor = 0,0,0, ;
		Height = 13, ;
		Left = 131, ;
		Name = "chkturno", ;
		TabIndex = 4, ;
		Top = 20, ;
		Width = 56
		*< END OBJECT: BaseClass="checkbox" />

	ADD OBJECT 'Chkusuario' AS checkbox WITH ;
		Alignment = 0, ;
		BackColor = 128,128,128, ;
		BackStyle = 0, ;
		Caption = "Usuario", ;
		FontBold = .T., ;
		FontName = "Tahoma", ;
		FontSize = 8, ;
		ForeColor = 0,0,0, ;
		Height = 13, ;
		Left = 287, ;
		Name = "Chkusuario", ;
		TabIndex = 6, ;
		Top = 20, ;
		Width = 62
		*< END OBJECT: BaseClass="checkbox" />

	ADD OBJECT 'Cmbisla' AS cmbfpago WITH ;
		Alignment = 0, ;
		BorderColor = 94,174,255, ;
		FontSize = 8, ;
		Height = 25, ;
		Left = 442, ;
		Name = "Cmbisla", ;
		RowSource = "Isla 1,Isla 2,Isla 3", ;
		RowSourceType = 1, ;
		TabIndex = 3, ;
		Top = 34, ;
		Width = 130
		*< END OBJECT: ClassLib="..\libs\sisven.vcx" BaseClass="combobox" />

	ADD OBJECT 'Cmbturno' AS cmbstock WITH ;
		BackColor = 255,255,255, ;
		BorderColor = 94,174,255, ;
		BoundColumn = 1, ;
		Height = 25, ;
		Left = 131, ;
		Name = "Cmbturno", ;
		RowSource = "Turno 1,Turno 2,Turno 3", ;
		TabIndex = 5, ;
		Top = 34, ;
		Width = 142
		*< END OBJECT: ClassLib="..\..\librerias\clasesvisuales.vcx" BaseClass="combobox" />

	ADD OBJECT 'cmbusuario' AS combobox WITH ;
		BackColor = 255,255,255, ;
		BorderColor = 94,174,255, ;
		FontBold = .F., ;
		FontName = "Tahoma", ;
		FontSize = 8, ;
		Height = 25, ;
		Left = 285, ;
		Name = "cmbusuario", ;
		RowSource = "", ;
		RowSourceType = 6, ;
		SpecialEffect = 1, ;
		Style = 2, ;
		TabIndex = 7, ;
		Top = 34, ;
		Width = 145
		*< END OBJECT: BaseClass="combobox" />

	ADD OBJECT 'Cmdaexcel1' AS cmdaexcel WITH ;
		calias = tc, ;
		cgriddata = thisform.grimodelos, ;
		FontBold = .T., ;
		FontName = "Arial Unicode MS", ;
		Height = 30, ;
		Left = 180, ;
		Name = "Cmdaexcel1", ;
		Picture = ..\..\, ;
		SpecialEffect = 0, ;
		TabIndex = 13, ;
		Themes = .T., ;
		Top = 528, ;
		Width = 85
		*< END OBJECT: ClassLib="..\libs\salidas.vcx" BaseClass="commandbutton" />

	ADD OBJECT 'Cmdconsulta' AS cmdconsulta WITH ;
		Alignment = 2, ;
		FontBold = .T., ;
		FontName = "Arial Unicode MS", ;
		Height = 33, ;
		Left = 575, ;
		Name = "Cmdconsulta", ;
		Picture = ..\..\, ;
		PicturePosition = 1, ;
		TabIndex = 8, ;
		Top = 26, ;
		Width = 97
		*< END OBJECT: ClassLib="..\libs\sisfotos.vcx" BaseClass="commandbutton" />

	ADD OBJECT 'Cmdconsulta2' AS cmdconsulta WITH ;
		BackColor = 192,192,192, ;
		Caption = "Detalle", ;
		FontBold = .T., ;
		FontName = "Arial Unicode MS", ;
		FontSize = 8, ;
		ForeColor = 0,0,0, ;
		Height = 30, ;
		Left = 267, ;
		MousePointer = 15, ;
		Name = "Cmdconsulta2", ;
		Picture = ..\..\, ;
		PicturePosition = 1, ;
		SpecialEffect = 0, ;
		Style = 0, ;
		Themes = .T., ;
		Top = 528, ;
		Visible = .T., ;
		Width = 85, ;
		WordWrap = .T.
		*< END OBJECT: ClassLib="..\libs\sisfotos.vcx" BaseClass="commandbutton" />

	ADD OBJECT 'Cmdimprimir' AS cmdimprimir WITH ;
		Enabled = .T., ;
		FontBold = .T., ;
		FontName = "Arial Unicode MS", ;
		FontSize = 8, ;
		Height = 30, ;
		Left = 1, ;
		Name = "Cmdimprimir", ;
		Picture = ..\..\, ;
		PicturePosition = 0, ;
		SpecialEffect = 0, ;
		TabIndex = 11, ;
		Themes = .T., ;
		Top = 528, ;
		Width = 85
		*< END OBJECT: ClassLib="..\libs\sisfotos.vcx" BaseClass="commandbutton" />

	ADD OBJECT 'Cmdvistaprevia' AS cmdvistaprevia WITH ;
		Enabled = .T., ;
		FontBold = .T., ;
		FontName = "Arial Unicode MS", ;
		FontSize = 8, ;
		Height = 30, ;
		Left = 90, ;
		Name = "Cmdvistaprevia", ;
		Picture = ..\..\, ;
		PicturePosition = 0, ;
		SpecialEffect = 0, ;
		TabIndex = 12, ;
		Themes = .T., ;
		Top = 528, ;
		Width = 85
		*< END OBJECT: ClassLib="..\libs\sisfotos.vcx" BaseClass="commandbutton" />

	ADD OBJECT 'Container1' AS container WITH ;
		BackColor = 128,128,128, ;
		BackStyle = 0, ;
		BorderColor = 255,255,255, ;
		Height = 45, ;
		Left = 6, ;
		Name = "Container1", ;
		TabIndex = 9, ;
		Top = 18, ;
		Width = 678
		*< END OBJECT: BaseClass="container" />

	ADD OBJECT 'Grimodelos' AS grimodelos WITH ;
		Height = 456, ;
		Left = 0, ;
		Name = "Grimodelos", ;
		ScrollBars = 2, ;
		TabIndex = 14, ;
		Top = 66, ;
		Width = 1156, ;
		Column1.Header1.Name = "Header1", ;
		Column1.Name = "Column1", ;
		Column1.Text1.Name = "Text1", ;
		Column2.Header1.Name = "Header1", ;
		Column2.Name = "Column2", ;
		Column2.Text1.Name = "Text1", ;
		Column3.Header1.Name = "Header1", ;
		Column3.Name = "Column3", ;
		Column3.Text1.Name = "Text1", ;
		Column4.Header1.Name = "Header1", ;
		Column4.Name = "Column4", ;
		Column4.Text1.Name = "Text1", ;
		Column5.Header1.Name = "Header1", ;
		Column5.Name = "Column5", ;
		Column5.Text1.Name = "Text1", ;
		Column6.Header1.Name = "Header1", ;
		Column6.Name = "Column6", ;
		Column6.Text1.Name = "Text1", ;
		Column7.Header1.Name = "Header1", ;
		Column7.Name = "Column7", ;
		Column7.Text1.Name = "Text1", ;
		Column8.Header1.Name = "Header1", ;
		Column8.Name = "Column8", ;
		Column8.Text1.Name = "Text1", ;
		Column9.Header1.Name = "Header1", ;
		Column9.Name = "Column9", ;
		Column9.Text1.Name = "Text1", ;
		Column10.Header1.Name = "Header1", ;
		Column10.Name = "Column10", ;
		Column10.Text1.Name = "Text1", ;
		Column11.Header1.Name = "Header1", ;
		Column11.Name = "Column11", ;
		Column11.Text1.Name = "Text1", ;
		Column12.Header1.Name = "Header1", ;
		Column12.Name = "Column12", ;
		Column12.Text1.Name = "Text1", ;
		Column13.Header1.Name = "Header1", ;
		Column13.Name = "Column13", ;
		Column13.Text1.Name = "Text1", ;
		Column14.Header1.Name = "Header1", ;
		Column14.Name = "Column14", ;
		Column14.Text1.Name = "Text1", ;
		Column15.Header1.Name = "Header1", ;
		Column15.Name = "Column15", ;
		Column15.Text1.Name = "Text1", ;
		COLUMN16.Header1.Name = "Header1", ;
		COLUMN16.Name = "COLUMN16", ;
		COLUMN16.Text1.Name = "Text1", ;
		COLUMN17.Header1.Name = "Header1", ;
		COLUMN17.Name = "COLUMN17", ;
		COLUMN17.Text1.Name = "Text1", ;
		COLUMN18.Header1.Name = "Header1", ;
		COLUMN18.Name = "COLUMN18", ;
		COLUMN18.Text1.Name = "Text1", ;
		COLUMN19.Header1.Name = "Header1", ;
		COLUMN19.Name = "COLUMN19", ;
		COLUMN19.Text1.Name = "Text1", ;
		COLUMN20.Header1.Name = "Header1", ;
		COLUMN20.Name = "COLUMN20", ;
		COLUMN20.Text1.Name = "Text1", ;
		COLUMN21.Header1.Name = "Header1", ;
		COLUMN21.Name = "COLUMN21", ;
		COLUMN21.Text1.Name = "Text1", ;
		COLUMN22.Header1.Name = "Header1", ;
		COLUMN22.Name = "COLUMN22", ;
		COLUMN22.Text1.Name = "Text1", ;
		COLUMN23.Header1.Name = "Header1", ;
		COLUMN23.Name = "COLUMN23", ;
		COLUMN23.Text1.Name = "Text1", ;
		COLUMN24.Header1.Name = "Header1", ;
		COLUMN24.Name = "COLUMN24", ;
		COLUMN24.Text1.Name = "Text1", ;
		COLUMN25.Header1.Name = "Header1", ;
		COLUMN25.Name = "COLUMN25", ;
		COLUMN25.Text1.Name = "Text1", ;
		COLUMN26.Header1.Name = "Header1", ;
		COLUMN26.Name = "COLUMN26", ;
		COLUMN26.Text1.Name = "Text1", ;
		COLUMN27.Header1.Name = "Header1", ;
		COLUMN27.Name = "COLUMN27", ;
		COLUMN27.Text1.Name = "Text1", ;
		COLUMN28.Header1.Name = "Header1", ;
		COLUMN28.Name = "COLUMN28", ;
		COLUMN28.Text1.Name = "Text1", ;
		COLUMN29.Header1.Name = "Header1", ;
		COLUMN29.Name = "COLUMN29", ;
		COLUMN29.Text1.Name = "Text1", ;
		COLUMN30.Header1.Name = "Header1", ;
		COLUMN30.Name = "COLUMN30", ;
		COLUMN30.Text1.Name = "Text1", ;
		COLUMN31.Header1.Name = "Header1", ;
		COLUMN31.Name = "COLUMN31", ;
		COLUMN31.Text1.Name = "Text1", ;
		COLUMN32.Header1.Name = "Header1", ;
		COLUMN32.Name = "COLUMN32", ;
		COLUMN32.Text1.Name = "Text1", ;
		COLUMN33.Header1.Name = "Header1", ;
		COLUMN33.Name = "COLUMN33", ;
		COLUMN33.Text1.Name = "Text1", ;
		COLUMN34.Header1.Name = "Header1", ;
		COLUMN34.Name = "COLUMN34", ;
		COLUMN34.Text1.Name = "Text1", ;
		COLUMN35.Header1.Name = "Header1", ;
		COLUMN35.Name = "COLUMN35", ;
		COLUMN35.Text1.Name = "Text1", ;
		COLUMN36.Header1.Name = "Header1", ;
		COLUMN36.Name = "COLUMN36", ;
		COLUMN36.Text1.Name = "Text1", ;
		COLUMN37.Header1.Name = "Header1", ;
		COLUMN37.Name = "COLUMN37", ;
		COLUMN37.Text1.Name = "Text1", ;
		COLUMN38.Header1.Name = "Header1", ;
		COLUMN38.Name = "COLUMN38", ;
		COLUMN38.Text1.Name = "Text1", ;
		COLUMN39.Header1.Name = "Header1", ;
		COLUMN39.Name = "COLUMN39", ;
		COLUMN39.Text1.Name = "Text1", ;
		COLUMN40.Header1.Name = "Header1", ;
		COLUMN40.Name = "COLUMN40", ;
		COLUMN40.Text1.Name = "Text1"
		*< END OBJECT: ClassLib="..\..\librerias\clasesvisuales.vcx" BaseClass="grid" />

	ADD OBJECT 'Label1' AS label WITH ;
		BackColor = 128,128,128, ;
		BackStyle = 0, ;
		Caption = "Fecha:", ;
		FontBold = .T., ;
		FontName = "Tahoma", ;
		FontSize = 8, ;
		ForeColor = 0,0,0, ;
		Height = 16, ;
		Left = 14, ;
		Name = "Label1", ;
		TabIndex = 10, ;
		Top = 19, ;
		Width = 39
		*< END OBJECT: BaseClass="label" />

	ADD OBJECT 'LBL1' AS lbl WITH ;
		Caption = "Cajero:", ;
		Height = 16, ;
		Left = 858, ;
		Name = "LBL1", ;
		Top = 46, ;
		Width = 46
		*< END OBJECT: ClassLib="..\..\librerias\clasesvisuales.vcx" BaseClass="label" />

	ADD OBJECT 'Txtfecha' AS txt WITH ;
		Alignment = 3, ;
		Height = 25, ;
		Left = 11, ;
		Name = "Txtfecha", ;
		ReadOnly = .F., ;
		TabIndex = 1, ;
		Top = 34, ;
		Value = (date()), ;
		Width = 105
		*< END OBJECT: ClassLib="..\libs\sisven.vcx" BaseClass="textbox" />

	ADD OBJECT 'Txtlocalizador1' AS txtlocalizador WITH ;
		FontSize = 8, ;
		Format = "!", ;
		Left = 919, ;
		Name = "Txtlocalizador1", ;
		TabIndex = 1, ;
		Top = 43
		*< END OBJECT: ClassLib="..\libs\sisven.vcx" BaseClass="textbox" />
	
	PROCEDURE Init
		Settear()
		If datosGlobales()=0 Then
			Return .F.
		Endif
		With This
			.grimodelos.RecordSource=""
			TexT TO lc noshow
		         SELECT nomb as usua,idusua FROM fe_usua WHERE activo='S' ORDER BY nomb
			ENDTEXT
				IF verificaconexion()=0 then
		RETURN 0
		endif
			If SQLExec(goapp.bdconn,lc,"lu")=-1
				ERRORbd(lc)
				Return
			Endif
			.cmbusuario.RowSource="lu.usua"
		    .cmbusuario.ListIndex=1
		    .cmdconsulta.Click()
		Endwith
		
	ENDPROC

	PROCEDURE Unload
		
		
	ENDPROC

	PROCEDURE Cmbisla.Init
		this.ListIndex=1
	ENDPROC

	PROCEDURE Cmbturno.Init
		this.ListIndex=1
	ENDPROC

	PROCEDURE Cmbturno.LostFocus
		this.Enabled= .t. 
	ENDPROC

	PROCEDURE Cmdconsulta.Click
		With Thisform
			solousuario=0
			If Left(goapp.tipousuario,1)<>"A" Then
				If This.Parent.chkusuario.Value=0 Then
					Messagebox("Seleccione Su USUARIO",16,MSGTITULO)
					Return
				Endif
				If lu.idusua<>goapp.nidusua Then
					Messagebox("NO Autorizado",16,MSGTITULO)
					Return
				Endif
				solousuario=lu.idusua
			Endif
			.grimodelos.RecordSource=""
			df=This.Parent.txtFECHA.Value
			nidus=lu.idusua
			nidt=Iif(This.Parent.cmbturno.ListIndex=1,1,Iif(This.Parent.cmbturno.ListIndex=2,2,3))
			nidi=Iif(This.Parent.cmbisla.ListIndex=1,1,Iif(This.Parent.cmbisla.ListIndex=2,2,3))
			If solousuario>0 Then
			   TEXT TO lc NOSHOW
				    select Cajero,Total_ventas,Liquidacion,turno,producto,cantidad,precio,venta,' ' as detalle,' ' as nro_documento,
					cast(0 as decimal(12,2)) as efectivo,cast(0 as decimal(12,2)) as credito,cast(0 as decimal(12,2)) as tarjeta,
					cast(0 as decimal(12,2)) as egresos,cast('00-00-00 00:00:00' as datetime) as fechao,orden from(
					select u.nomb as Cajero,Total_ventas,Liquidacion,turn_refe as Turno,producto,cantidad,precio,venta,orden from(
					select sum(total_ventas) as total_ventas,sum(liquidacion) as liquidacion,lcaj_idus,lcaj_idtu,
					' ' as Producto,cast(0 as decimal(12,2)) as cantidad,cast(0 as decimal(12,2)) as precio,
					cast(0 as decimal(12,2)) as Venta,'a' as orden from(
					SELECT sum(a.lcaj_deud) Total_Ventas,cast(0 as decimal(12,2)) as Liquidacion,lcaj_idus,lcaj_idtu FROM fe_lcaja  as a
					WHERE a.lcaj_acti='A' and lcaj_idau>0 and lcaj_fech=?df and lcaj_idtu=?nidt and lcaj_codt=?nidi and lcaj_idus=?nidus group by lcaj_idtu,lcaj_idus
					union all
					SELECT cast(0 as decimal(12,2)) as Total_ventas,SUM(if(a.lcaj_deud<>0,lcaj_deud,-lcaj_acre)) as Liquidacion,
					lcaj_idus,lcaj_idtu FROM fe_lcaja  as a WHERE  a.lcaj_acti='A' and a.lcaj_form='E' and lcaj_idtu=?nidt and lcaj_codt=?nidi and lcaj_idus=?nidus group by lcaj_idtu,lcaj_idus)
					as y group by lcaj_idus,lcaj_idtu
					union all
					select cast(0 as decimal(12,2)) as Total_Ventas,cast(0 as decimal(12,2)) as Liquidacion,r.idusua as lcaj_idus,r.rcom_idtr as lcaj_idtu,
					descri as Producto,cast(sum(k.cant) as decimal(12,2)) as cantidad,
					cast(sum(k.cant*k.prec)/sum(k.cant) as decimal(12,2)) as precio,cast(sum(k.cant*k.prec) as decimal(12,2)) as Venta,'b' as orden
					from fe_kar as k inner join fe_art as a on a.idart=k.idart inner join fe_rcom as r on r.idauto=k.idauto
					where k.acti='A' and r.acti='A' and r.fecr=?df  and rcom_idtr=?nidt and k.alma=?nidi and idusua=?nidus group by k.idart,r.idusua,r.rcom_idtr) as x
					inner join fe_usua as u on u.idusua=x.lcaj_idus inner join fe_turnos as t on t.turn_idtur=x.lcaj_idtu) as a
					union all
					select l.Cajero,cast(0 as decimal(12,2)) as Total_ventas,cast(0 as decimal(12,2)) as Liquidacion,
					turno,' ' as producto,cast(0 as decimal(12,2)) as cantidad,cast(0 as decimal(12,2)) as precio,
					cast(0 as decimal(12,2)) as venta,
					l.deta as detalle,l.ndoc as nro_documento,l.efectivo,l.credito,l.tarjeta,
					l.egresos,l.fechao,orden from
					(select nomb as cajero,deta,ndoc,
					round(case forma when 'E' then if(b.tipo='I',impo,0) else 0 end,2) as efectivo,
					round(case forma when 'C' then if(b.tipo='I',impo,0) else 0 end,2) as credito,
					round(case forma when 'T' then if(b.tipo='I',impo,0) else 0 end,2) as tarjeta,
					round(case b.tipo when 'S' then if(forma='E',impo,0) else 0 end,2) as egresos,
					fechao,t.turn_refe as turno,orden
					from(
					SELECT a.lcaj_form as forma,if(lcaj_deud<>0,'I',if(lcaj_acre=0,'I','S')) as tipo,lcaj_dcto as ndoc,
					if(lcaj_deud<>0,lcaj_deud,if(lcaj_acre=0,lcaj_deud,lcaj_acre)) as impo,
					lcaj_deta as deta,a.lcaj_fope as fechao,lcaj_idus,lcaj_idtu,'c' as orden FROM
					fe_lcaja as a WHERE lcaj_acti<>'I' and lcaj_idau>0 and lcaj_fech=?df and lcaj_idtu=?nidt and lcaj_codt=?nidi and lcaj_idus=?nidus   union all
					SELECT a.lcaj_form as forma,if(lcaj_deud<>0,'I','S') as tipo,a.lcaj_ndoc as ndoc,if(a.lcaj_deud<>0,lcaj_deud,lcaj_acre) as impo,
					a.lcaj_deta as deta,a.lcaj_fope as fechao,lcaj_idus,lcaj_idtu,'d' as orden FROM
					fe_lcaja as a WHERE lcaj_acti<>'I' and lcaj_idau=0  and lcaj_fech=?df and lcaj_idtu=?nidt and lcaj_codt=?nidi and lcaj_idus=?nidus )
					as b inner join fe_usua as u on u.idusua=b.lcaj_idus left join fe_turnos as t on t.turn_idtur=b.lcaj_idtu order by b.tipo,ndoc) as l
					order by cajero,turno,orden,nro_documento
				ENDTEXT
			Else
		    	Do Case
				Case This.Parent.chkturno.Value=1 And This.Parent.chkisla.Value=1 And This.Parent.chkusuario.Value=1
					TEXT TO lc NOSHOW
				    select Cajero,Total_ventas,Liquidacion,turno,producto,cantidad,precio,venta,' ' as detalle,' ' as nro_documento,
					cast(0 as decimal(12,2)) as efectivo,cast(0 as decimal(12,2)) as credito,cast(0 as decimal(12,2)) as tarjeta,
					cast(0 as decimal(12,2)) as egresos,cast('00-00-00 00:00:00' as datetime) as fechao,orden from(
					select u.nomb as Cajero,Total_ventas,Liquidacion,turn_refe as Turno,producto,cantidad,precio,venta,orden from(
					select sum(total_ventas) as total_ventas,sum(liquidacion) as liquidacion,lcaj_idus,lcaj_idtu,
					' ' as Producto,cast(0 as decimal(12,2)) as cantidad,cast(0 as decimal(12,2)) as precio,
					cast(0 as decimal(12,2)) as Venta,'a' as orden from(
					SELECT sum(a.lcaj_deud) Total_Ventas,cast(0 as decimal(12,2)) as Liquidacion,lcaj_idus,lcaj_idtu FROM fe_lcaja  as a
					WHERE a.lcaj_acti='A' and lcaj_idau>0 and lcaj_fech=?df and lcaj_idtu=?nidt and lcaj_codt=?nidi group by lcaj_idtu,lcaj_idus
					union all
					SELECT cast(0 as decimal(12,2)) as Total_ventas,SUM(if(a.lcaj_deud<>0,lcaj_deud,-lcaj_acre)) as Liquidacion,
					lcaj_idus,lcaj_idtu FROM fe_lcaja  as a WHERE  a.lcaj_acti='A' and a.lcaj_form='E' and lcaj_idtu=?nidt and lcaj_codt=?nidi group by lcaj_idtu,lcaj_idus)
					as y group by lcaj_idus,lcaj_idtu
					union all
					select cast(0 as decimal(12,2)) as Total_Ventas,cast(0 as decimal(12,2)) as Liquidacion,r.idusua as lcaj_idus,r.rcom_idtr as lcaj_idtu,
					descri as Producto,cast(sum(k.cant) as decimal(12,2)) as cantidad,
					cast(sum(k.cant*k.prec)/sum(k.cant) as decimal(12,2)) as precio,cast(sum(k.cant*k.prec) as decimal(12,2)) as Venta,'b' as orden
					from fe_kar as k inner join fe_art as a on a.idart=k.idart inner join fe_rcom as r on r.idauto=k.idauto
					where k.acti='A' and r.acti='A' and r.fecr=?df  and rcom_idtr=?nidt and k.alma=?nidi and idusua=?nidus group by k.idart,r.idusua,r.rcom_idtr) as x
					inner join fe_usua as u on u.idusua=x.lcaj_idus inner join fe_turnos as t on t.turn_idtur=x.lcaj_idtu) as a
					union all
					select l.Cajero,cast(0 as decimal(12,2)) as Total_ventas,cast(0 as decimal(12,2)) as Liquidacion,
					turno,' ' as producto,cast(0 as decimal(12,2)) as cantidad,cast(0 as decimal(12,2)) as precio,
					cast(0 as decimal(12,2)) as venta,
					l.deta as detalle,l.ndoc as nro_documento,l.efectivo,l.credito,l.tarjeta,
					l.egresos,l.fechao,orden from
					(select nomb as cajero,deta,ndoc,
					round(case forma when 'E' then if(b.tipo='I',impo,0) else 0 end,2) as efectivo,
					round(case forma when 'C' then if(b.tipo='I',impo,0) else 0 end,2) as credito,
					round(case forma when 'T' then if(b.tipo='I',impo,0) else 0 end,2) as tarjeta,
					round(case b.tipo when 'S' then if(forma='E',impo,0) else 0 end,2) as egresos,
					fechao,t.turn_refe as turno,orden
					from(
					SELECT a.lcaj_form as forma,if(lcaj_deud<>0,'I',if(lcaj_acre=0,'I','S')) as tipo,lcaj_dcto as ndoc,
					if(lcaj_deud<>0,lcaj_deud,if(lcaj_acre=0,lcaj_deud,lcaj_acre)) as impo,
					lcaj_deta as deta,a.lcaj_fope as fechao,lcaj_idus,lcaj_idtu,'c' as orden FROM
					fe_lcaja as a WHERE lcaj_acti<>'I' and lcaj_idau>0 and lcaj_fech=?df and lcaj_idtu=?nidt and lcaj_codt=?nidi and lcaj_idus=?nidus   union all
					SELECT a.lcaj_form as forma,if(lcaj_deud<>0,'I','S') as tipo,a.lcaj_ndoc as ndoc,if(a.lcaj_deud<>0,lcaj_deud,lcaj_acre) as impo,
					a.lcaj_deta as deta,a.lcaj_fope as fechao,lcaj_idus,lcaj_idtu,'d' as orden FROM
					fe_lcaja as a WHERE lcaj_acti<>'I' and lcaj_idau=0  and lcaj_fech=?df and lcaj_idtu=?nidt and lcaj_codt=?nidi and lcaj_idus=?nidus )
					as b inner join fe_usua as u on u.idusua=b.lcaj_idus left join fe_turnos as t on t.turn_idtur=b.lcaj_idtu order by b.tipo,ndoc) as l
					order by cajero,turno,orden,nro_documento
					ENDTEXT
				Case This.Parent.chkturno.Value=1 And This.Parent.chkisla.Value=1 And This.Parent.chkusuario.Value=0
					TEXT TO lc NOSHOW
				    select Cajero,Total_ventas,Liquidacion,turno,producto,cantidad,precio,venta,' ' as detalle,' ' as nro_documento,
					cast(0 as decimal(12,2)) as efectivo,cast(0 as decimal(12,2)) as credito,cast(0 as decimal(12,2)) as tarjeta,
					cast(0 as decimal(12,2)) as egresos,cast('00-00-00 00:00:00' as datetime) as fechao,orden from(
					select u.nomb as Cajero,Total_ventas,Liquidacion,turn_refe as Turno,producto,cantidad,precio,venta,orden from(
					select sum(total_ventas) as total_ventas,sum(liquidacion) as liquidacion,lcaj_idus,lcaj_idtu,
					' ' as Producto,cast(0 as decimal(12,2)) as cantidad,cast(0 as decimal(12,2)) as precio,
					cast(0 as decimal(12,2)) as Venta,'a' as orden from(
					SELECT sum(a.lcaj_deud) Total_Ventas,cast(0 as decimal(12,2)) as Liquidacion,lcaj_idus,lcaj_idtu FROM fe_lcaja  as a
					WHERE a.lcaj_acti='A' and lcaj_idau>0 and lcaj_fech=?df and lcaj_idtu=?nidt and lcaj_codt=?nidi group by lcaj_idtu,lcaj_idus
					union all
					SELECT cast(0 as decimal(12,2)) as Total_ventas,SUM(if(a.lcaj_deud<>0,lcaj_deud,-lcaj_acre)) as Liquidacion,
					lcaj_idus,lcaj_idtu FROM fe_lcaja  as a WHERE  a.lcaj_acti='A' and a.lcaj_form='E' and lcaj_idtu=?nidt and lcaj_codt=?nidi group by lcaj_idtu,lcaj_idus)
					as y group by lcaj_idus,lcaj_idtu
					union all
					select cast(0 as decimal(12,2)) as Total_Ventas,cast(0 as decimal(12,2)) as Liquidacion,r.idusua as lcaj_idus,r.rcom_idtr as lcaj_idtu,
					descri as Producto,cast(sum(k.cant) as decimal(12,2)) as cantidad,
					cast(sum(k.cant*k.prec)/sum(k.cant) as decimal(12,2)) as precio,cast(sum(k.cant*k.prec) as decimal(12,2)) as Venta,'b' as orden
					from fe_kar as k inner join fe_art as a on a.idart=k.idart inner join fe_rcom as r on r.idauto=k.idauto
					where k.acti='A' and r.acti='A' and r.fecr=?df  and rcom_idtr=?nidt and k.alma=?nidi group by k.idart,r.idusua,r.rcom_idtr) as x
					inner join fe_usua as u on u.idusua=x.lcaj_idus inner join fe_turnos as t on t.turn_idtur=x.lcaj_idtu) as a
					union all
					select l.Cajero,cast(0 as decimal(12,2)) as Total_ventas,cast(0 as decimal(12,2)) as Liquidacion,
					turno,' ' as producto,cast(0 as decimal(12,2)) as cantidad,cast(0 as decimal(12,2)) as precio,
					cast(0 as decimal(12,2)) as venta,
					l.deta as detalle,l.ndoc as nro_documento,l.efectivo,l.credito,l.tarjeta,
					l.egresos,l.fechao,orden from
					(select nomb as cajero,deta,ndoc,
					round(case forma when 'E' then if(b.tipo='I',impo,0) else 0 end,2) as efectivo,
					round(case forma when 'C' then if(b.tipo='I',impo,0) else 0 end,2) as credito,
					round(case forma when 'T' then if(b.tipo='I',impo,0) else 0 end,2) as tarjeta,
					round(case b.tipo when 'S' then if(forma='E',impo,0) else 0 end,2) as egresos,
					fechao,t.turn_refe as turno,orden
					from(
					SELECT a.lcaj_form as forma,if(lcaj_deud<>0,'I',if(lcaj_acre=0,'I','S')) as tipo,lcaj_dcto as ndoc,
					if(lcaj_deud<>0,lcaj_deud,if(lcaj_acre=0,lcaj_deud,lcaj_acre)) as impo,
					lcaj_deta as deta,a.lcaj_fope as fechao,lcaj_idus,lcaj_idtu,'c' as orden FROM
					fe_lcaja as a WHERE lcaj_acti<>'I' and lcaj_idau>0 and lcaj_fech=?df and lcaj_idtu=?nidt and lcaj_codt=?nidi   union all
					SELECT a.lcaj_form as forma,if(lcaj_deud<>0,'I','S') as tipo,a.lcaj_ndoc as ndoc,if(a.lcaj_deud<>0,lcaj_deud,lcaj_acre) as impo,
					a.lcaj_deta as deta,a.lcaj_fope as fechao,lcaj_idus,lcaj_idtu,'d' as orden FROM
					fe_lcaja as a WHERE lcaj_acti<>'I' and lcaj_idau=0  and lcaj_fech=?df and lcaj_idtu=?nidt and lcaj_codt=?nidi )
					as b inner join fe_usua as u on u.idusua=b.lcaj_idus left join fe_turnos as t on t.turn_idtur=b.lcaj_idtu order by b.tipo,ndoc) as l
					order by cajero,turno,orden,nro_documento
					ENDTEXT
				Case This.Parent.chkturno.Value=1 And This.Parent.chkisla.Value=0 And This.Parent.chkusuario.Value=0
					TEXT TO lc NOSHOW
				    select Cajero,Total_ventas,Liquidacion,turno,producto,cantidad,precio,venta,' ' as detalle,' ' as nro_documento,
					cast(0 as decimal(12,2)) as efectivo,cast(0 as decimal(12,2)) as credito,cast(0 as decimal(12,2)) as tarjeta,
					cast(0 as decimal(12,2)) as egresos,cast('00-00-00 00:00:00' as datetime) as fechao,orden from(
					select u.nomb as Cajero,Total_ventas,Liquidacion,turn_refe as Turno,producto,cantidad,precio,venta,orden from(
					select sum(total_ventas) as total_ventas,sum(liquidacion) as liquidacion,lcaj_idus,lcaj_idtu,
					' ' as Producto,cast(0 as decimal(12,2)) as cantidad,cast(0 as decimal(12,2)) as precio,
					cast(0 as decimal(12,2)) as Venta,'a' as orden from(
					SELECT sum(a.lcaj_deud) Total_Ventas,cast(0 as decimal(12,2)) as Liquidacion,lcaj_idus,lcaj_idtu FROM fe_lcaja  as a
					WHERE a.lcaj_acti='A' and lcaj_idau>0 and lcaj_fech=?df and lcaj_idtu=?nidt group by lcaj_idtu,lcaj_idus
					union all
					SELECT cast(0 as decimal(12,2)) as Total_ventas,SUM(if(a.lcaj_deud<>0,lcaj_deud,-lcaj_acre)) as Liquidacion,
					lcaj_idus,lcaj_idtu FROM fe_lcaja  as a WHERE  a.lcaj_acti='A' and a.lcaj_form='E' and lcaj_idtu=?nidt group by lcaj_idtu,lcaj_idus)
					as y group by lcaj_idus,lcaj_idtu
					union all
					select cast(0 as decimal(12,2)) as Total_Ventas,cast(0 as decimal(12,2)) as Liquidacion,r.idusua as lcaj_idus,r.rcom_idtr as lcaj_idtu,
					descri as Producto,cast(sum(k.cant) as decimal(12,2)) as cantidad,
					cast(sum(k.cant*k.prec)/sum(k.cant) as decimal(12,2)) as precio,cast(sum(k.cant*k.prec) as decimal(12,2)) as Venta,'b' as orden
					from fe_kar as k inner join fe_art as a on a.idart=k.idart inner join fe_rcom as r on r.idauto=k.idauto
					where k.acti='A' and r.acti='A' and r.fecr=?df  and rcom_idtr=?nidt group by k.idart,r.idusua,r.rcom_idtr) as x
					inner join fe_usua as u on u.idusua=x.lcaj_idus inner join fe_turnos as t on t.turn_idtur=x.lcaj_idtu) as a
					union all
					select l.Cajero,cast(0 as decimal(12,2)) as Total_ventas,cast(0 as decimal(12,2)) as Liquidacion,
					turno,' ' as producto,cast(0 as decimal(12,2)) as cantidad,cast(0 as decimal(12,2)) as precio,
					cast(0 as decimal(12,2)) as venta,
					l.deta as detalle,l.ndoc as nro_documento,l.efectivo,l.credito,l.tarjeta,
					l.egresos,l.fechao,orden from
					(select nomb as cajero,deta,ndoc,
					round(case forma when 'E' then if(b.tipo='I',impo,0) else 0 end,2) as efectivo,
					round(case forma when 'C' then if(b.tipo='I',impo,0) else 0 end,2) as credito,
					round(case forma when 'T' then if(b.tipo='I',impo,0) else 0 end,2) as tarjeta,
					round(case b.tipo when 'S' then if(forma='E',impo,0) else 0 end,2) as egresos,
					fechao,t.turn_refe as turno,orden
					from(
					SELECT a.lcaj_form as forma,if(lcaj_deud<>0,'I',if(lcaj_acre=0,'I','S')) as tipo,lcaj_dcto as ndoc,
					if(lcaj_deud<>0,lcaj_deud,if(lcaj_acre=0,lcaj_deud,lcaj_acre)) as impo,
					lcaj_deta as deta,a.lcaj_fope as fechao,lcaj_idus,lcaj_idtu,'c' as orden FROM
					fe_lcaja as a WHERE lcaj_acti<>'I' and lcaj_idau>0 and lcaj_fech=?df and lcaj_idtu=?nidt union all
					SELECT a.lcaj_form as forma,if(lcaj_deud<>0,'I','S') as tipo,a.lcaj_ndoc as ndoc,if(a.lcaj_deud<>0,lcaj_deud,lcaj_acre) as impo,
					a.lcaj_deta as deta,a.lcaj_fope as fechao,lcaj_idus,lcaj_idtu,'d' as orden FROM
					fe_lcaja as a WHERE lcaj_acti<>'I' and lcaj_idau=0  and lcaj_fech=?df and lcaj_idtu=?nidt)
					as b inner join fe_usua as u on u.idusua=b.lcaj_idus left join fe_turnos as t on t.turn_idtur=b.lcaj_idtu order by b.tipo,ndoc) as l
					order by cajero,turno,orden,nro_documento
					ENDTEXT
				Otherwise
					TEXT TO lc NOSHOW
				    select Cajero,Total_ventas,Liquidacion,turno,producto,cantidad,precio,venta,' ' as detalle,' ' as nro_documento,
					cast(0 as decimal(12,2)) as efectivo,cast(0 as decimal(12,2)) as credito,cast(0 as decimal(12,2)) as tarjeta,
					cast(0 as decimal(12,2)) as egresos,cast('00-00-00 00:00:00' as datetime) as fechao,orden from(
					select u.nomb as Cajero,Total_ventas,Liquidacion,turn_refe as Turno,producto,cantidad,precio,venta,orden from(
					select sum(total_ventas) as total_ventas,sum(liquidacion) as liquidacion,lcaj_idus,lcaj_idtu,
					' ' as Producto,cast(0 as decimal(12,2)) as cantidad,cast(0 as decimal(12,2)) as precio,
					cast(0 as decimal(12,2)) as Venta,'a' as orden from(
					SELECT sum(a.lcaj_deud) as  Total_Ventas,cast(0 as decimal(12,2)) as Liquidacion,lcaj_idus,lcaj_idtu FROM fe_lcaja  as a
					WHERE a.lcaj_acti='A' and lcaj_idau>0 and lcaj_fech=?df group by lcaj_idtu,lcaj_idus
					union all
					SELECT cast(0 as decimal(12,2)) as Total_ventas,SUM(if(a.lcaj_deud<>0,lcaj_deud,-lcaj_acre)) as Liquidacion,
					lcaj_idus,lcaj_idtu FROM fe_lcaja  as a WHERE  a.lcaj_acti='A' and a.lcaj_form='E' group by lcaj_idtu,lcaj_idus)
					as y group by lcaj_idus,lcaj_idtu
					union all
					select cast(0 as decimal(12,2)) as Total_Ventas,cast(0 as decimal(12,2)) as Liquidacion,r.idusua as lcaj_idus,r.rcom_idtr as lcaj_idtu,
					descri as Producto,cast(sum(k.cant) as decimal(12,2)) as cantidad,
					cast(sum(k.cant*k.prec)/sum(k.cant) as decimal(12,2)) as precio,cast(sum(k.cant*k.prec) as decimal(12,2)) as Venta,'b' as orden
					from fe_kar as k inner join fe_art as a on a.idart=k.idart inner join fe_rcom as r on r.idauto=k.idauto
					where k.acti='A' and r.acti='A' and r.fecr=?df  group by k.idart,r.idusua,r.rcom_idtr) as x
					inner join fe_usua as u on u.idusua=x.lcaj_idus inner join fe_turnos as t on t.turn_idtur=x.lcaj_idtu) as a
					union all
					select l.Cajero,cast(0 as decimal(12,2)) as Total_ventas,cast(0 as decimal(12,2)) as Liquidacion,
					turno,' ' as producto,cast(0 as decimal(12,2)) as cantidad,cast(0 as decimal(12,2)) as precio,
					cast(0 as decimal(12,2)) as venta,
					l.deta as detalle,l.ndoc as nro_documento,l.efectivo,l.credito,l.tarjeta,
					l.egresos,l.fechao,orden from
					(select nomb as cajero,deta,ndoc,
					round(case forma when 'E' then if(b.tipo='I',impo,0) else 0 end,2) as efectivo,
					round(case forma when 'C' then if(b.tipo='I',impo,0) else 0 end,2) as credito,
					round(case forma when 'T' then if(b.tipo='I',impo,0) else 0 end,2) as tarjeta,
					round(case b.tipo when 'S' then if(forma='E',impo,0) else 0 end,2) as egresos,
					fechao,t.turn_refe as turno,orden
					from(
					SELECT a.lcaj_form as forma,if(lcaj_deud<>0,'I',if(lcaj_acre=0,'I','S')) as tipo,lcaj_dcto as ndoc,
					if(lcaj_deud<>0,lcaj_deud,if(lcaj_acre=0,lcaj_deud,lcaj_acre)) as impo,
					lcaj_deta as deta,a.lcaj_fope as fechao,lcaj_idus,lcaj_idtu,'c' as orden FROM
					fe_lcaja as a WHERE lcaj_acti<>'I' and lcaj_idau>0 and lcaj_fech=?df union all
					SELECT a.lcaj_form as forma,if(lcaj_deud<>0,'I','S') as tipo,a.lcaj_ndoc as ndoc,if(a.lcaj_deud<>0,lcaj_deud,lcaj_acre) as impo,
					a.lcaj_deta as deta,a.lcaj_fope as fechao,lcaj_idus,lcaj_idtu,'d' as orden FROM
					fe_lcaja as a WHERE lcaj_acti<>'I' and lcaj_idau=0  and lcaj_fech=?df)
					as b inner join fe_usua as u on u.idusua=b.lcaj_idus left join fe_turnos as t on t.turn_idtur=b.lcaj_idtu order by b.tipo,ndoc) as l
					order by cajero,turno,orden,nro_documento
					ENDTEXT
				Endcase
			ENDIF
				IF verificaconexion()=0 then
		RETURN 0
		endif
			If SQLExec(goapp.bdconn,lc,"tc")<1
				errorbd(lc)
				Return
			Endif
			Select * From tc Into Cursor tc1
			.grimodelos.RecordSource="tc"
			.grimodelos.AutoFit()
			.grimodelos.colocartituloscolumnas()
			.grimodelos.SetAll("dynamicbackcolor","iif(MOD(RECNO(),2)=0,RGB(234,234,255),RGB(247,247,242))","Column")
			.grimodelos.SetFocus
		Endwith
		
	ENDPROC

	PROCEDURE Cmdconsulta2.Click
		goapp.form("ka_liquidax")
	ENDPROC

	PROCEDURE Cmdimprimir.Click
		If verificaAlias("tc1")=1 Then
			Select tc
			*Report Form infrcaja To Printer  Prompt Noconsole
		Endif
		
	ENDPROC

	PROCEDURE Cmdvistaprevia.Click
		If verificaAlias("tc")=1 Then
			Select tc
			*Report Form infrcaja Preview
		Endif
		
	ENDPROC

	PROCEDURE Txtlocalizador1.InteractiveChange
		Local cvalor
		If verificaAlias("tc")=1 Then
			cvalor=Alltrim(This.Value)
			Thisform.grimodelos.RecordSource=""
			Select * From tc1 Where cajero Like '%'+cvalor+'%' Into Cursor tc
			Thisform.grimodelos.RecordSource="tc"
			Thisform.grimodelos.SetAll("dynamicbackcolor","iif(MOD(RECNO(),2)=0,RGB(234,234,255),RGB(247,247,242))","Column")
		Endif
		
		
	ENDPROC

	PROCEDURE Txtlocalizador1.LostFocus
		thisform.grimodelos.SetFocus 
	ENDPROC

ENDDEFINE
