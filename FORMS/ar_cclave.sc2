*--------------------------------------------------------------------------------------------------------------------------------------------------------
* (ES) AUTOGENERADO - ¡¡ATENCIÓN!! - ¡¡NO PENSADO PARA EJECUTAR!! USAR SOLAMENTE PARA INTEGRAR CAMBIOS Y ALMACENAR CON HERRAMIENTAS SCM!!
* (EN) AUTOGENERATED - ATTENTION!! - NOT INTENDED FOR EXECUTION!! USE ONLY FOR MERGING CHANGES AND STORING WITH SCM TOOLS!!
*--------------------------------------------------------------------------------------------------------------------------------------------------------
*< FOXBIN2PRG: Version="1.19" SourceFile="ar_cclave.scx" /> (Solo para binarios VFP 9 / Only for VFP 9 binaries)
*
*
#INCLUDE "..\include\sisfotos.h"

DEFINE CLASS dataenvironment AS dataenvironment 
 	*< CLASSDATA: Baseclass="dataenvironment" Timestamp="" Scale="" Uniqueid="" ClassIcon="1" />

	DataSource = .NULL.
	Height = 0
	Left = 0
	Name = "Dataenvironment"
	Top = 0
	Width = 0

ENDDEFINE

DEFINE CLASS fmr1 AS fmr OF "..\libs\sisven.vcx" 
 	*< CLASSDATA: Baseclass="form" Timestamp="" Scale="" Uniqueid="" />

	*-- OBJECTDATA items order determines ZOrder / El orden de los items OBJECTDATA determina el ZOrder 
	*< OBJECTDATA: ObjPath="Cmdcerraro1" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Cmdaceptar1" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Container1" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="lblclave" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Label3" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="txtclaven" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="txtclave2" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="txtclave" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Label1" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="lblusuario" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Titulo1" UniqueID="" Timestamp="" />

	*<DefinedPropArrayMethod>
		*p: clave
		*p: usuario
	*</DefinedPropArrayMethod>

	AutoCenter = .T.
	BorderStyle = 1
	Caption = "[Cambiar Clave]"
	clave = .F.
	DoCreate = .T.
	Height = 220
	Name = "Fmr1"
	ShowWindow = 2
	TitleBar = 0
	usuario = .F.
	Width = 269
	WindowType = 1

	ADD OBJECT 'Cmdaceptar1' AS cmdaceptar WITH ;
		Height = 21, ;
		Left = 10, ;
		Name = "Cmdaceptar1", ;
		Picture = ..\..\, ;
		TabIndex = 4, ;
		Top = 182, ;
		Width = 82
		*< END OBJECT: ClassLib="..\libs\sisfotos.vcx" BaseClass="commandbutton" />

	ADD OBJECT 'Cmdcerraro1' AS cmdcerraro WITH ;
		Height = 25, ;
		Left = 178, ;
		Name = "Cmdcerraro1", ;
		Picture = ..\..\, ;
		TabIndex = 5, ;
		Top = 182, ;
		Width = 82
		*< END OBJECT: ClassLib="..\libs\sisfotos.vcx" BaseClass="commandbutton" />

	ADD OBJECT 'Container1' AS container WITH ;
		BackColor = 255,255,234, ;
		Height = 138, ;
		Left = 4, ;
		Name = "Container1", ;
		TabIndex = 8, ;
		Top = 37, ;
		Width = 259
		*< END OBJECT: BaseClass="container" />

	ADD OBJECT 'Label1' AS label WITH ;
		Alignment = 2, ;
		BackColor = 192,192,192, ;
		BackStyle = 0, ;
		Caption = "Nueva Clave:", ;
		FontBold = .T., ;
		FontName = "Arial Unicode MS", ;
		FontSize = 8, ;
		FontUnderline = .F., ;
		Height = 14, ;
		Left = 18, ;
		Name = "Label1", ;
		TabIndex = 6, ;
		Top = 124, ;
		Width = 101
		*< END OBJECT: BaseClass="label" />

	ADD OBJECT 'Label3' AS label WITH ;
		BackColor = 192,192,192, ;
		BackStyle = 0, ;
		Caption = "Confirmar Clave:", ;
		FontBold = .T., ;
		FontName = "Arial Unicode MS", ;
		FontSize = 8, ;
		FontUnderline = .F., ;
		Height = 14, ;
		Left = 151, ;
		Name = "Label3", ;
		TabIndex = 9, ;
		Top = 124, ;
		Width = 96
		*< END OBJECT: BaseClass="label" />

	ADD OBJECT 'lblclave' AS label WITH ;
		Alignment = 2, ;
		BackColor = 192,192,192, ;
		BackStyle = 0, ;
		Caption = "Clave Actual:", ;
		FontBold = .T., ;
		FontName = "Arial Unicode MS", ;
		FontSize = 8, ;
		FontUnderline = .F., ;
		Height = 14, ;
		Left = 18, ;
		Name = "lblclave", ;
		TabIndex = 7, ;
		Top = 65, ;
		Width = 98
		*< END OBJECT: BaseClass="label" />

	ADD OBJECT 'lblusuario' AS label WITH ;
		Alignment = 2, ;
		BackColor = 192,192,192, ;
		BackStyle = 0, ;
		Caption = "Clave Actual:", ;
		FontBold = .T., ;
		FontName = "Arial Unicode MS", ;
		FontSize = 9, ;
		FontUnderline = .F., ;
		Height = 14, ;
		Left = 16, ;
		Name = "lblusuario", ;
		TabIndex = 7, ;
		Top = 45, ;
		Width = 236
		*< END OBJECT: BaseClass="label" />

	ADD OBJECT 'Titulo1' AS titulo WITH ;
		Left = -1, ;
		Name = "Titulo1", ;
		Top = 0, ;
		Shape1.Name = "Shape1", ;
		Lbl1.Caption = "[Cambiar Clave]", ;
		Lbl1.Name = "Lbl1", ;
		Image1.Name = "Image1", ;
		Image1.Visible = .F., ;
		Image3.Name = "Image3", ;
		Image2.Name = "Image2"
		*< END OBJECT: ClassLib="..\..\librerias\clasesvisuales.vcx" BaseClass="container" />

	ADD OBJECT 'txtclave' AS textbox WITH ;
		BorderColor = 94,174,255, ;
		FontName = "Tahoma", ;
		FontSize = 8, ;
		Format = "!", ;
		Height = 25, ;
		Left = 20, ;
		Margin = 2, ;
		MaxLength = 12, ;
		Name = "txtclave", ;
		PasswordChar = "*", ;
		SelectOnEntry = .T., ;
		SpecialEffect = 1, ;
		StatusBarText = "Ingrese la clave de Acceso al Sistema ", ;
		TabIndex = 1, ;
		Top = 83, ;
		Width = 97
		*< END OBJECT: BaseClass="textbox" />

	ADD OBJECT 'txtclave2' AS textbox WITH ;
		BorderColor = 94,174,255, ;
		FontName = "Tahoma", ;
		FontSize = 8, ;
		Format = "!", ;
		Height = 25, ;
		Left = 151, ;
		MaxLength = 12, ;
		Name = "txtclave2", ;
		PasswordChar = "*", ;
		ReadOnly = .T., ;
		SelectOnEntry = .T., ;
		SpecialEffect = 1, ;
		StatusBarText = "Ingrese Su Clave de Acceso al Sistema", ;
		TabIndex = 3, ;
		Top = 145, ;
		Visible = .T., ;
		Width = 97
		*< END OBJECT: BaseClass="textbox" />

	ADD OBJECT 'txtclaven' AS textbox WITH ;
		BorderColor = 94,174,255, ;
		FontName = "Tahoma", ;
		FontSize = 8, ;
		Format = "!", ;
		Height = 25, ;
		Left = 20, ;
		Margin = 2, ;
		MaxLength = 12, ;
		Name = "txtclaven", ;
		PasswordChar = "*", ;
		ReadOnly = .T., ;
		SelectOnEntry = .T., ;
		SpecialEffect = 1, ;
		StatusBarText = "Ingrese la clave de Acceso al Sistema ", ;
		TabIndex = 2, ;
		Top = 145, ;
		Visible = .T., ;
		Width = 96
		*< END OBJECT: BaseClass="textbox" />
	
	PROCEDURE Init
		Lparameters usua,cla,idus
		Thisform.lblusuario.Caption="Usuario:"+Alltrim(usua)
		Thisform.usuario=idus
		If !Empty(cla) Then
			This.clave=cla
		Else
			TEXT TO lc noshow
		       SELECT clave FROM fe_usua WHERE idusua=?idus
			ENDTEXT
			IF verificaconexion()=0 then
		RETURN 0
		endif
			ncon=Abreconexion()
			If SQLExec(ncon,lc,'kus')<1 Then
				errorbd(lc)
				Return .F.
			Endif
			cierraconexion(ncon)
			Thisform.clave=kus.clave
		Endif
		Thisform.txtclave.SetFocus
		
	ENDPROC

	PROCEDURE Cmdaceptar1.Click
		Local r
		r=PreguntaGuardar()
		Do Case
		Case r=2
			Thisform.txtclave2.SetFocus
		Case r=6
			cclave=Thisform.txtclave2.Value
			nid=Thisform.usuario
			TEXT TO lc NOSHOW
		             UPDATE fe_usua SET clave=?cclave WHERE idusua=?nid
			ENDTEXT
			IF verificaconexion()=0 then
		RETURN 0
		endif
			If SQLExec(goapp.bdconn,lc)<1
				errorbd(lc)
				Return
			Endif
			Thisform.cmdcerraro1.Click()
		Case r=7
			Thisform.cmdcerraro1.Click()
		Endcase
		
	ENDPROC

	PROCEDURE txtclave.LostFocus
		If Len(Alltrim(This.Value))>0 then
			If Alltrim(This.Value)=Alltrim(Thisform.clave)
				Thisform.txtclave2.ReadOnly= .F.
				Thisform.txtclaven.ReadOnly= .F.
			Else
				Messagebox("Clave Incorrecta",16,MSGTITULO)
				Thisform.txtclave2.ReadOnly= .T.
				Thisform.txtclaven.ReadOnly= .T.
			Endif
		Endif
		
	ENDPROC

	PROCEDURE txtclave2.GotFocus
		IF EMPTY(thisform.txtclaven.value)
		   thisform.txtclaven.setfocus
		   RETURN 
		ENDIF 
		
	ENDPROC

	PROCEDURE txtclave2.LostFocus
		If Trim(This.Value)<>Trim(Thisform.txtclaven.Value)
			Messagebox("Vuelva a Escribir la Clave para poder Confirmarla",48,MSGTITULO)
			Thisform.txtclaven.SetFocus
			Return
		Endif
		
	ENDPROC

ENDDEFINE
