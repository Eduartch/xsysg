*--------------------------------------------------------------------------------------------------------------------------------------------------------
* (ES) AUTOGENERADO - ¡¡ATENCIÓN!! - ¡¡NO PENSADO PARA EJECUTAR!! USAR SOLAMENTE PARA INTEGRAR CAMBIOS Y ALMACENAR CON HERRAMIENTAS SCM!!
* (EN) AUTOGENERATED - ATTENTION!! - NOT INTENDED FOR EXECUTION!! USE ONLY FOR MERGING CHANGES AND STORING WITH SCM TOOLS!!
*--------------------------------------------------------------------------------------------------------------------------------------------------------
*< FOXBIN2PRG: Version="1.19" SourceFile="ka_jalaruc.old.scx" /> (Solo para binarios VFP 9 / Only for VFP 9 binaries)
*
*
#INCLUDE "..\include\sisfotos.h"

DEFINE CLASS dataenvironment AS dataenvironment 
 	*< CLASSDATA: Baseclass="dataenvironment" Timestamp="" Scale="" Uniqueid="" ClassIcon="1" />

	DataSource = .NULL.
	Height = 0
	Left = 0
	Name = "Dataenvironment"
	Top = 0
	Width = 0

ENDDEFINE

DEFINE CLASS fmr1 AS fmr OF "..\libs\sisven.vcx" 
 	*< CLASSDATA: Baseclass="form" Timestamp="" Scale="" Uniqueid="" />

	*-- OBJECTDATA items order determines ZOrder / El orden de los items OBJECTDATA determina el ZOrder 
	*< OBJECTDATA: ObjPath="Shape8" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Label1" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="TxtRuc" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Text1" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Text2" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Text3" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Text4" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Text5" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Text6" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Text7" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Label4" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Label5" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Label6" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Label7" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Label8" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Label9" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Label10" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Text8" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Label11" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Text9" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Label12" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Text10" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Label13" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Text11" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Label14" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Text12" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Label15" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Combo1" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Label16" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Cmdaceptar1" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Cmdcerrar1" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Container1" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Label3" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Command1" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Label2" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="TxtCodigo" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Command2" UniqueID="" Timestamp="" />

	*<DefinedPropArrayMethod>
		*m: buscar_datos_ruc
		*m: conexion_ie
		*m: convertircaptchatexto
		*m: leercaptcha
		*m: limpiar_datos
		*m: waitw
		*p: vdvto
	*</DefinedPropArrayMethod>

	BorderStyle = 1
	Caption = "<Importar Desde www.Sunat.gob.pe>"
	codigo = 0
	DoCreate = .T.
	Height = 478
	Left = 59
	Name = "Fmr1"
	Top = 12
	vdvto = 0
	Width = 638
	WindowType = 1

	ADD OBJECT 'Cmdaceptar1' AS cmdaceptar WITH ;
		BackColor = 192,192,192, ;
		Caption = "Aceptar", ;
		FontBold = .T., ;
		FontSize = 8, ;
		Height = 35, ;
		Left = 19, ;
		Name = "Cmdaceptar1", ;
		PicturePosition = 0, ;
		TabIndex = 33, ;
		Top = 428, ;
		Width = 85
		*< END OBJECT: ClassLib="..\libs\sisfotos.vcx" BaseClass="commandbutton" />

	ADD OBJECT 'Cmdcerrar1' AS cmdcerrar WITH ;
		BackColor = 192,192,192, ;
		FontBold = .T., ;
		FontSize = 8, ;
		Height = 35, ;
		Left = 542, ;
		Name = "Cmdcerrar1", ;
		TabIndex = 34, ;
		Top = 428, ;
		Width = 85
		*< END OBJECT: ClassLib="..\libs\sisfotos.vcx" BaseClass="commandbutton" />

	ADD OBJECT 'Combo1' AS combobox WITH ;
		FontName = "Tahoma", ;
		FontSize = 8, ;
		Height = 24, ;
		Left = 156, ;
		Name = "Combo1", ;
		Style = 2, ;
		TabIndex = 32, ;
		Top = 396, ;
		Width = 469
		*< END OBJECT: BaseClass="combobox" />

	ADD OBJECT 'Command1' AS commandbutton WITH ;
		Caption = "Buscar", ;
		FontBold = .T., ;
		FontName = "Tahoma", ;
		FontSize = 8, ;
		ForeColor = 33,112,154, ;
		Height = 25, ;
		Left = 275, ;
		MousePointer = 15, ;
		Name = "Command1", ;
		Picture = ..\graphics\find.bmp, ;
		PicturePosition = 1, ;
		TabIndex = 15, ;
		Top = 60, ;
		Width = 69
		*< END OBJECT: BaseClass="commandbutton" />

	ADD OBJECT 'Command2' AS commandbutton WITH ;
		Caption = "  Actualizar Imagen", ;
		FontName = "Tahoma", ;
		FontSize = 8, ;
		ForeColor = 0,128,0, ;
		Height = 25, ;
		Left = 467, ;
		MousePointer = 15, ;
		Name = "Command2", ;
		Picture = ..\graphics\refresh.bmp, ;
		PicturePosition = 1, ;
		TabIndex = 16, ;
		Top = 79, ;
		Width = 152
		*< END OBJECT: BaseClass="commandbutton" />

	ADD OBJECT 'Container1' AS container WITH ;
		BackColor = 33,112,154, ;
		BackStyle = 1, ;
		BorderColor = 41,138,190, ;
		Height = 24, ;
		Left = 10, ;
		Name = "Container1", ;
		TabIndex = 30, ;
		Top = 106, ;
		Width = 620
		*< END OBJECT: BaseClass="container" />

	ADD OBJECT 'Label1' AS label WITH ;
		AutoSize = .T., ;
		BackStyle = 0, ;
		Caption = "Número de RUC:", ;
		FontBold = .T., ;
		FontName = "Tahoma", ;
		FontSize = 8, ;
		ForeColor = 0,0,128, ;
		Height = 15, ;
		Left = 28, ;
		Name = "Label1", ;
		TabIndex = 17, ;
		Top = 46, ;
		Width = 92
		*< END OBJECT: BaseClass="label" />

	ADD OBJECT 'Label10' AS label WITH ;
		AutoSize = .T., ;
		BackStyle = 0, ;
		Caption = "Domicilio Fiscal:", ;
		FontBold = .T., ;
		FontName = "Tahoma", ;
		FontSize = 8, ;
		ForeColor = 0,0,128, ;
		Height = 15, ;
		Left = 69, ;
		Name = "Label10", ;
		TabIndex = 28, ;
		Top = 306, ;
		Width = 90
		*< END OBJECT: BaseClass="label" />

	ADD OBJECT 'Label11' AS label WITH ;
		AutoSize = .T., ;
		BackStyle = 0, ;
		Caption = "Fecha de Inscripción:", ;
		FontBold = .T., ;
		FontName = "Tahoma", ;
		FontSize = 8, ;
		ForeColor = 0,0,128, ;
		Height = 15, ;
		Left = 380, ;
		Name = "Label11", ;
		TabIndex = 24, ;
		Top = 258, ;
		Width = 120
		*< END OBJECT: BaseClass="label" />

	ADD OBJECT 'Label12' AS label WITH ;
		AutoSize = .T., ;
		BackStyle = 0, ;
		Caption = "Fecha de Inicio de Actividades:", ;
		FontBold = .T., ;
		FontName = "Tahoma", ;
		FontSize = 8, ;
		ForeColor = 0,0,128, ;
		Height = 15, ;
		Left = 326, ;
		Name = "Label12", ;
		TabIndex = 16, ;
		Top = 282, ;
		Width = 175
		*< END OBJECT: BaseClass="label" />

	ADD OBJECT 'Label13' AS label WITH ;
		AutoSize = .T., ;
		BackStyle = 0, ;
		Caption = "Emisión Comprobante:", ;
		FontBold = .T., ;
		FontName = "Tahoma", ;
		FontSize = 8, ;
		ForeColor = 0,0,128, ;
		Height = 15, ;
		Left = 28, ;
		Name = "Label13", ;
		TabIndex = 25, ;
		Top = 352, ;
		Width = 128
		*< END OBJECT: BaseClass="label" />

	ADD OBJECT 'Label14' AS label WITH ;
		AutoSize = .T., ;
		BackStyle = 0, ;
		Caption = "Actividad de Comercio:", ;
		FontBold = .T., ;
		FontName = "Tahoma", ;
		FontSize = 8, ;
		ForeColor = 0,0,128, ;
		Height = 15, ;
		Left = 315, ;
		Name = "Label14", ;
		TabIndex = 27, ;
		Top = 352, ;
		Width = 131
		*< END OBJECT: BaseClass="label" />

	ADD OBJECT 'Label15' AS label WITH ;
		AutoSize = .T., ;
		BackStyle = 0, ;
		Caption = "Sistema de Contabilidad:", ;
		FontBold = .T., ;
		FontName = "Tahoma", ;
		FontSize = 8, ;
		ForeColor = 0,0,128, ;
		Height = 15, ;
		Left = 17, ;
		Name = "Label15", ;
		TabIndex = 29, ;
		Top = 376, ;
		Width = 141
		*< END OBJECT: BaseClass="label" />

	ADD OBJECT 'Label16' AS label WITH ;
		AutoSize = .T., ;
		BackStyle = 0, ;
		Caption = "Actividad Económica:", ;
		FontBold = .T., ;
		FontName = "Tahoma", ;
		FontSize = 8, ;
		ForeColor = 0,0,128, ;
		Height = 15, ;
		Left = 33, ;
		Name = "Label16", ;
		TabIndex = 26, ;
		Top = 400, ;
		Width = 121
		*< END OBJECT: BaseClass="label" />

	ADD OBJECT 'Label2' AS label WITH ;
		AutoSize = .T., ;
		BackStyle = 0, ;
		Caption = "Ingrese código que se muestra en la Imagen:", ;
		FontBold = .T., ;
		FontName = "Tahoma", ;
		FontSize = 8, ;
		ForeColor = 0,0,128, ;
		Height = 15, ;
		Left = 158, ;
		Name = "Label2", ;
		TabIndex = 33, ;
		Top = 45, ;
		Width = 257
		*< END OBJECT: BaseClass="label" />

	ADD OBJECT 'Label3' AS label WITH ;
		AutoSize = .T., ;
		BackStyle = 0, ;
		Caption = "INFORMACIÓN DEL CONTRIBUYENTE", ;
		FontBold = .T., ;
		FontName = "Tahoma", ;
		ForeColor = 255,255,255, ;
		Height = 16, ;
		Left = 145, ;
		Name = "Label3", ;
		TabIndex = 31, ;
		Top = 109, ;
		Width = 218
		*< END OBJECT: BaseClass="label" />

	ADD OBJECT 'Label4' AS label WITH ;
		AutoSize = .T., ;
		BackStyle = 0, ;
		Caption = "Número de RUC:", ;
		FontBold = .T., ;
		FontName = "Tahoma", ;
		FontSize = 8, ;
		ForeColor = 0,0,128, ;
		Height = 15, ;
		Left = 59, ;
		Name = "Label4", ;
		TabIndex = 21, ;
		Top = 138, ;
		Width = 92
		*< END OBJECT: BaseClass="label" />

	ADD OBJECT 'Label5' AS label WITH ;
		AutoSize = .T., ;
		BackStyle = 0, ;
		Caption = "Nombre ó Razon Social:", ;
		FontBold = .T., ;
		FontName = "Tahoma", ;
		FontSize = 8, ;
		ForeColor = 0,0,128, ;
		Height = 15, ;
		Left = 22, ;
		Name = "Label5", ;
		TabIndex = 18, ;
		Top = 160, ;
		Width = 133
		*< END OBJECT: BaseClass="label" />

	ADD OBJECT 'Label6' AS label WITH ;
		AutoSize = .T., ;
		BackStyle = 0, ;
		Caption = "Tipo Contribuyente:", ;
		FontBold = .T., ;
		FontName = "Tahoma", ;
		FontSize = 8, ;
		ForeColor = 0,0,128, ;
		Height = 15, ;
		Left = 40, ;
		Name = "Label6", ;
		TabIndex = 23, ;
		Top = 209, ;
		Width = 113
		*< END OBJECT: BaseClass="label" />

	ADD OBJECT 'Label7' AS label WITH ;
		AutoSize = .T., ;
		BackStyle = 0, ;
		Caption = "Nombre Comercial:", ;
		FontBold = .T., ;
		FontName = "Tahoma", ;
		FontSize = 8, ;
		ForeColor = 0,0,128, ;
		Height = 15, ;
		Left = 48, ;
		Name = "Label7", ;
		TabIndex = 20, ;
		Top = 234, ;
		Width = 108
		*< END OBJECT: BaseClass="label" />

	ADD OBJECT 'Label8' AS label WITH ;
		AutoSize = .T., ;
		BackStyle = 0, ;
		Caption = "Estado:", ;
		FontBold = .T., ;
		FontName = "Tahoma", ;
		FontSize = 8, ;
		ForeColor = 0,0,128, ;
		Height = 15, ;
		Left = 109, ;
		Name = "Label8", ;
		TabIndex = 19, ;
		Top = 258, ;
		Width = 43
		*< END OBJECT: BaseClass="label" />

	ADD OBJECT 'Label9' AS label WITH ;
		AutoSize = .T., ;
		BackStyle = 0, ;
		Caption = "Condición:", ;
		FontBold = .T., ;
		FontName = "Tahoma", ;
		FontSize = 8, ;
		ForeColor = 0,0,128, ;
		Height = 15, ;
		Left = 94, ;
		Name = "Label9", ;
		TabIndex = 22, ;
		Top = 281, ;
		Width = 59
		*< END OBJECT: BaseClass="label" />

	ADD OBJECT 'Shape8' AS shape WITH ;
		BackColor = 248,248,248, ;
		BackStyle = 0, ;
		BorderColor = 127,157,185, ;
		Curvature = 10, ;
		Height = 465, ;
		Left = 10, ;
		Name = "Shape8", ;
		Top = 3, ;
		Width = 621, ;
		ZOrderSet = 0
		*< END OBJECT: BaseClass="shape" />

	ADD OBJECT 'Text1' AS textbox WITH ;
		Alignment = 3, ;
		Enabled = .F., ;
		FontName = "Tahoma", ;
		Format = "", ;
		Height = 23, ;
		InputMask = "", ;
		Left = 156, ;
		MaxLength = 0, ;
		Name = "Text1", ;
		TabIndex = 2, ;
		Top = 134, ;
		Value = , ;
		Width = 123
		*< END OBJECT: BaseClass="textbox" />

	ADD OBJECT 'Text10' AS textbox WITH ;
		Alignment = 3, ;
		Enabled = .F., ;
		FontName = "Tahoma", ;
		Format = "", ;
		Height = 23, ;
		InputMask = "", ;
		Left = 156, ;
		MaxLength = 0, ;
		Name = "Text10", ;
		TabIndex = 10, ;
		Top = 348, ;
		Value = , ;
		Width = 156
		*< END OBJECT: BaseClass="textbox" />

	ADD OBJECT 'Text11' AS textbox WITH ;
		Alignment = 3, ;
		Enabled = .F., ;
		FontName = "Tahoma", ;
		Format = "", ;
		Height = 23, ;
		InputMask = "", ;
		Left = 444, ;
		MaxLength = 0, ;
		Name = "Text11", ;
		TabIndex = 11, ;
		Top = 348, ;
		Value = , ;
		Width = 180
		*< END OBJECT: BaseClass="textbox" />

	ADD OBJECT 'Text12' AS textbox WITH ;
		Alignment = 3, ;
		Enabled = .F., ;
		FontName = "Tahoma", ;
		Format = "", ;
		Height = 23, ;
		InputMask = "", ;
		Left = 156, ;
		MaxLength = 0, ;
		Name = "Text12", ;
		TabIndex = 12, ;
		Top = 372, ;
		Value = , ;
		Width = 156
		*< END OBJECT: BaseClass="textbox" />

	ADD OBJECT 'Text2' AS textbox WITH ;
		Alignment = 3, ;
		Enabled = .F., ;
		FontName = "Tahoma", ;
		Format = "", ;
		Height = 46, ;
		InputMask = "", ;
		Left = 156, ;
		MaxLength = 0, ;
		Name = "Text2", ;
		TabIndex = 3, ;
		Top = 158, ;
		Value = , ;
		Width = 469
		*< END OBJECT: BaseClass="textbox" />

	ADD OBJECT 'Text3' AS textbox WITH ;
		Alignment = 3, ;
		Enabled = .F., ;
		FontName = "Tahoma", ;
		Format = "", ;
		Height = 23, ;
		InputMask = "", ;
		Left = 156, ;
		MaxLength = 0, ;
		Name = "Text3", ;
		TabIndex = 4, ;
		Top = 205, ;
		Value = , ;
		Width = 469
		*< END OBJECT: BaseClass="textbox" />

	ADD OBJECT 'Text4' AS textbox WITH ;
		Alignment = 3, ;
		Enabled = .F., ;
		FontName = "Tahoma", ;
		Format = "", ;
		Height = 23, ;
		InputMask = "", ;
		Left = 156, ;
		MaxLength = 0, ;
		Name = "Text4", ;
		TabIndex = 5, ;
		Top = 229, ;
		Value = , ;
		Width = 469
		*< END OBJECT: BaseClass="textbox" />

	ADD OBJECT 'Text5' AS textbox WITH ;
		Alignment = 3, ;
		Enabled = .F., ;
		FontName = "Tahoma", ;
		Format = "", ;
		Height = 23, ;
		InputMask = "", ;
		Left = 156, ;
		MaxLength = 0, ;
		Name = "Text5", ;
		TabIndex = 14, ;
		Top = 253, ;
		Value = , ;
		Width = 123
		*< END OBJECT: BaseClass="textbox" />

	ADD OBJECT 'Text6' AS textbox WITH ;
		Alignment = 3, ;
		Enabled = .F., ;
		FontName = "Tahoma", ;
		Format = "", ;
		Height = 23, ;
		InputMask = "", ;
		Left = 156, ;
		MaxLength = 0, ;
		Name = "Text6", ;
		TabIndex = 7, ;
		Top = 277, ;
		Value = , ;
		Width = 123
		*< END OBJECT: BaseClass="textbox" />

	ADD OBJECT 'Text7' AS textbox WITH ;
		Alignment = 3, ;
		Enabled = .F., ;
		FontName = "Tahoma", ;
		Format = "", ;
		Height = 46, ;
		InputMask = "", ;
		Left = 156, ;
		MaxLength = 0, ;
		Name = "Text7", ;
		TabIndex = 8, ;
		Top = 301, ;
		Value = , ;
		Width = 469
		*< END OBJECT: BaseClass="textbox" />

	ADD OBJECT 'Text8' AS textbox WITH ;
		Alignment = 3, ;
		Enabled = .F., ;
		FontName = "Tahoma", ;
		Format = "", ;
		Height = 23, ;
		InputMask = "", ;
		Left = 498, ;
		MaxLength = 0, ;
		Name = "Text8", ;
		TabIndex = 6, ;
		Top = 253, ;
		Value = {}, ;
		Width = 126
		*< END OBJECT: BaseClass="textbox" />

	ADD OBJECT 'Text9' AS textbox WITH ;
		Alignment = 3, ;
		Enabled = .F., ;
		FontName = "Tahoma", ;
		Format = "", ;
		Height = 23, ;
		InputMask = "", ;
		Left = 498, ;
		MaxLength = 0, ;
		Name = "Text9", ;
		TabIndex = 9, ;
		Top = 277, ;
		Value = {}, ;
		Width = 126
		*< END OBJECT: BaseClass="textbox" />

	ADD OBJECT 'TxtCodigo' AS textbox WITH ;
		Alignment = 3, ;
		FontName = "Tahoma", ;
		Format = "!", ;
		Height = 23, ;
		InputMask = "", ;
		Left = 159, ;
		MaxLength = 4, ;
		Name = "TxtCodigo", ;
		TabIndex = 14, ;
		Top = 62, ;
		Value = , ;
		Width = 113
		*< END OBJECT: BaseClass="textbox" />

	ADD OBJECT 'TxtRuc' AS textbox WITH ;
		Alignment = 3, ;
		FontName = "Tahoma", ;
		Format = "", ;
		Height = 23, ;
		InputMask = "99999999999", ;
		Left = 28, ;
		MaxLength = 11, ;
		Name = "TxtRuc", ;
		TabIndex = 1, ;
		Top = 62, ;
		Value = , ;
		Width = 126
		*< END OBJECT: BaseClass="textbox" />
	
	PROCEDURE buscar_datos_ruc
		Lparameters cruc,ccodigo
		*http://e-consultaruc.sunat.gob.pe/cl-ti-itmrconsruc/jcrS00Alias?accion=consPorRuc&nroRuc=20254053822&codigo=MBWU
		cfile=Sys(5)+Sys(2003)+'\ruc.txt'
		url='http://e-consultaruc.sunat.gob.pe/cl-ti-itmrconsruc/jcrS00Alias?accion=consPorRuc&nroRuc='+cruc+'&codigo='+ccodigo
		Bajar(url,cfile)
		
	ENDPROC

	PROCEDURE conexion_ie
		*!* DETERMINAR SI EXISTE UNA LINEA SEGURA DE INTERNET
		Declare Integer InternetCheckConnection In wininet.Dll String lpszUrl,Integer dwFlags,Integer dwReserved
		
		Local ln,llInternetStatus,lcURL
		
		lcURL = "http://www.sunat.gob.pe"
		llInternetStatus = (InternetCheckConnection(lcURL, 1, 0) == 1)
		
		If !llInternetStatus
			Return .F.
		Endif
		
		Return .T.
	ENDPROC

	PROCEDURE convertircaptchatexto
	ENDPROC

	PROCEDURE Init
		Lparameters cnruc
		Try
		
			DoDefault()
			This.WaitW("CARGANDO FORMULARIO. ESPERE POR FAVOR")
		*!*
			If !This.Conexion_IE ()
				Messagebox("No tiene una conexión activa de INTERNET, para continuar",48,SoftWare)
				Return .F.
			Endif
		*!*
			Thisform.txtruc.Value=Iif(Vartype(cnruc)='L','',cnruc)
			Create Cursor xmlclientes(nombre c(100),direccion c(100),ruc c(11))
			Wait Clear
			This.AddObject("_web","OleControl","shell.explorer")
			URLDestino="http://e-consultaruc.sunat.gob.pe/cl-ti-itmrconsruc/captcha?accion=image"
			With Thisform._Web
				.Top = 15
				.Left= 468
				.Width = 155
				.Height = 65
				.Visible =.T.
				.Navigate2(URLDestino)
			Endwith
			This.txtcodigo.SetFocus
		Catch To m.oerror
			Messagebox("No Se puede Obtener DATOS Solicitados",16,'Sisven')
		Finally
		Endtry
		
		
	ENDPROC

	PROCEDURE leercaptcha
		cfile=Sys(5)+Sys(2003)+'\Sunat.JPG'
		cfile1=Sys(5)+Sys(2003)+'\txt1.txt'
		cfile11=Sys(5)+Sys(2003)+'\txt1.txt.txt'
		url='http://e-consultaruc.sunat.gob.pe/cl-ti-itmrconsruc/captcha?accion=image'
		Bajar(url,cfile)
		Local oWSH
		oWSH = Createobject("WScript.Shell")
		Cexe=Sys(5)+Sys(2003)+"\tesseract.exe "+cfile + ' '+cfile1 +" -psm 7"
		oWSH.Run(Cexe,2,.T.)
		If File(cfile11) Then
			gnErrFile = Fopen(cfile11,12)&&si es así,abrir para leer y   escribir
			v1= Fgets(gnErrFile)
			=Fclose(gnErrFile)
			vcaptcha=""
			vcad=""
			For x=1 To 10
				If Substr(v1,x,1)<>' ' Then
					vcad=Substr(v1,x,1)
					vcaptcha=vcaptcha+vcad
				Endif
				If Len(Alltrim(vcaptcha))=4 Then
					Exit
				Endif
			Endfor
			Return Alltrim(vcaptcha)
		Else
			Return ''
		Endif
		
	ENDPROC

	PROCEDURE limpiar_datos
		Lparameters llValor
		
		If !llValor
			This.Text1.Value = ''
			This.Text2.Value = ''
			This.Text3.Value = ''
			This.Text4.Value = ''
			This.Text5.Value = ''
			This.Text6.Value = ''
			This.Text7.Value = ''
			This.Text8.Value = {}
			This.Text9.Value = {}
			This.Text10.Value = ""
			this.txtcodigo.Value=""
			This.Text11.Value = ""
			This.Text12.Value = ""
			This.Combo1.Clear ()
		Endif
		
	ENDPROC

	PROCEDURE Unload
		RETURN (thisform.vdvto)
	ENDPROC

	PROCEDURE waitw
		Lparameters lcMess
		
		If Type("lcMess") = "L"
			Return .F.
		Endif
		
		Wait Window lcMess At Srows()/2,(Scols()/2 - (Len(lcMess)/2)) Nowait
		
	ENDPROC

	PROCEDURE Cmdaceptar1.Click
		Insert Into xmlclientes(nombre,direccion,ruc)Values(Thisform.Text2.Value,IIF(LEFT(thisform.text1.Value,2)='20',thisform.text7.Value,''),Thisform.Text1.Value)
		thisform.vdvto=1
		Thisform.Release()
		
	ENDPROC

	PROCEDURE Cmdcerrar1.Click
		Zap In xmlclientes
		Thisform.vdvto=0
		DoDefault()
		
	ENDPROC

	PROCEDURE Command1.Click
		If Empty(Thisform.TxtRuc.Value)
			Messagebox("Ingrese número de RUC, para buscar información",48,MSGTITULO)
			Thisform.TxtRuc.SetFocus ()
			Return .F.
		Endif
		If Empty(Thisform.TxtCodigo.Value)
			Messagebox("Ingrese Código, para buscar información",48,SoftWare)
			Thisform.TxtCodigo.SetFocus ()
			Return .F.
		Endif
		*Set Procedure To capadatos,bajar Additive
		*http://e-consultaruc.sunat.gob.pe/cl-ti-itmrconsruc/jcrS00Alias?accion=consPorRuc&nroRuc=20254053822&codigo=MBWU
		*If !Thisform.Buscar_Datos_Ruc (Thisform.TxtRuc.Value,Thisform.TxtCodigo.Value)
		*	*!* HUBO ERROR
		*	Thisform.Limpiar_Datos ()
		*	Thisform.TxtRuc.SetFocus ()
		*	Return .F.
		*Endif
		cruc=Thisform.TxtRuc.Value
		ccodigo=Thisform.TxtCodigo.Value
		#Define CRLF Chr(13)+Chr(10)
		Local oErr As Exception
		Local cStr As Character
		Local SW As Boolean
		SW = .T.
		Try
			Local loXmlHttp As Microsoft.XMLHTTP,;
				lcURL As String,;
				lcHTML As String,;
				lcTexto As String,;
				lcFile As String
		
			loXmlHttp = Createobject("Microsoft.XMLHTTP")
			*http://e-consultaruc.sunat.gob.pe/cl-ti-itmrconsruc/jcrS00Alias?accion=consPorRuc&nroRuc=20254053822&codigo=MBWU
			*cfile=Sys(5)+Sys(2003)+'\ruc.txt'
			lcURL='http://e-consultaruc.sunat.gob.pe/cl-ti-itmrconsruc/jcrS00Alias?accion=consPorRuc&nroRuc='+cruc+'&codigo='+ccodigo
			*Bajar(url,cfile)
		
			*
			*lcURL = "http://www.sunat.gob.pe/w/wapS01Alias?ruc="+xruc
			*lcURL = "http://ww1.sunat.gob.pe/cl-ti-itmrconsruc/jcrS00Alias?ruc="+XRUC
			loXmlHttp.Open("POST" , lcURL, .F.)
			loXmlHttp.Send
		
			Thisform.waitw("Espere por favor, obteniendo datos desde www.sunat.gob.pe")
			Do While loXmlHttp.readystate<>4 Or loXmlHttp.Status <>200
			Enddo
			Wait Clear
			lcHTML = loXmlHttp.Responsetext
			lcTexto = Chrtran(Alltrim(lcHTML),Chr(10),"")
			*** RAZON SOCIAL ***
			xRazSocial = Strextract(lcTexto,'<td  class="bg" colspan=3>','</td>')
			Thisform.text1.Value=Left(xRazSocial,11)
			Thisform.text2.Value=Substr(xRazSocial,15)
		
		
		
			*** ESTADO ***
			
			PosIni = At("Estado del Contribuyente: ", lcTexto)+71
			PosFin = At("</b></small><br/>", lcTexto)-(At("Situacion:", lcTexto)+10)
			xest = Substr(lcTexto,PosIni)
		    thisform.text5.Value=Xest
		 
		
			*** AGENTE RETENEDOR IGV ***
			PosIni = At("ARIGV:", lcTexto)+18
			PosFin = At("ARIGV:", lcTexto)+20-(At("ARIGV:", lcTexto)+18)
			xAR = Substr(lcTexto,PosIni,PosFin)
			cagente=xAR
		
		
			*** DIRECCION ***
			PosIni=At("Direcci&oacute;n del Domicilio Fiscal:",lcTexto)
			PosFin = At("</b></small><br/>", lcTexto)-(At("Situacion:", lcTexto)+10)
			xDireccion=Substr(lcTexto,PosIni+87)
			Thisform.text7.Value=Alltrim(xDireccion)
		
			*** SITUACION ***
			
			PosIni = At("Condici&oacute;n del Contribuyente:", lcTexto)+95
			PosFin = (At("ARIGV", lcTexto)-32)-(At("Estado:", lcTexto)+7)
			xCond = Substr(lcTexto,PosIni)
			thisform.text6.Value=Xcond
		
			*** TELEFONO ***
			PosIni = At("Telefono:", lcTexto)+9
			PosFin = At("Dependencia:", lcTexto)-25-(At("Telefono:", lcTexto)+9)
			xTelef = Substr(lcTexto,PosIni,PosFin)
		
			*** TIPO DE PERSONA ***
			PosIni = At("TipoPer:", lcTexto)+8
			PosFin = At("DNI:", lcTexto)-29-(At("TipoPer:", lcTexto)+8)
			xTipoPer = Substr(lcTexto,PosIni,PosFin)
		
			*** DNI ***
			PosIni = At("DNI:", lcTexto)+4
			PosFin = At("FechNac:", lcTexto)-25-(At("DNI:", lcTexto)+4)
			xDNI = Substr(lcTexto,PosIni,PosFin)
		
		
			*** FECHA DE NACIMIENTO ***
			PosIni = At("FechNac:", lcTexto)+8
			PosFin = At("FechNac:", lcTexto)+18-(At("FechNac:", lcTexto)+8)
			xFechNac = Substr(lcTexto,PosIni,PosFin)
			
			
			*****Inicio de Actividades
			PosIni=At("Fecha de Inscripci&oacute;n: ",lcTexto)+74
			*PosFin = 
			xFi=Substr(lcTexto,PosIni,10)
			Thisform.text8.Value=Alltrim(xFi)
		
		
			Release loXmlHttp
		
		Catch To oErr
			cStr = "Error:" + CRLF + CRLF + ;
				"[  Error: ] " + Str(oErr.ErrorNo) + CRLF + ;
				"[  Linea: ] " + Str(oErr.Lineno) + CRLF + ;
				"[  Mensaje: ] " + oErr.Message + CRLF + ;
				"[  Procedimiento: ] " + oErr.Procedure + CRLF + ;
				"[  Detalles: ] " + oErr.Details + CRLF + ;
				"[  StackLevel: ] " + Str(oErr.StackLevel) + CRLF + ;
				"[  Instrucción: ] " + oErr.LineContents
			Messagebox(cStr,4112,"Error...!!!")
		Endtry
		
		Return
		*!* RUC CONSULTADO CORRECTAMENTE
		
	ENDPROC

	PROCEDURE Command2.Click
		URLDestino="http://e-consultaruc.sunat.gob.pe/cl-ti-itmrconsruc/captcha?accion=image"
		With Thisform._Web
			.Navigate2(URLDestino)
		Endwith
		
	ENDPROC

	PROCEDURE Text1.InteractiveChange
		IF EMPTY(THIS.Value)
		   THISFORM.Limpiar_Datos ()
		ENDIF   
	ENDPROC

	PROCEDURE Text1.Valid
		IF !EMPTY(THIS.Value)
		   IF LEN(ALLTRIM(THIS.Value)) <> 11
		      MESSAGEBOX("No se ha ingreado correctamente el Número de RUC. Verificar !!",48,MSGTITULO)
		      THISFORM.Limpiar_Datos ()
		      RETURN 0
		   ENDIF
		ENDIF
	ENDPROC

	PROCEDURE Text10.InteractiveChange
		IF EMPTY(THIS.Value)
		   THISFORM.Limpiar_Datos ()
		ENDIF   
	ENDPROC

	PROCEDURE Text10.Valid
		IF !EMPTY(THIS.Value)
		   IF LEN(ALLTRIM(THIS.Value)) <> 11
		      MESSAGEBOX("No se ha ingreado correctamente el Número de RUC. Verificar !!",48,MSGTITULO)
		      THISFORM.Limpiar_Datos ()
		      RETURN 0
		   ENDIF
		ENDIF
	ENDPROC

	PROCEDURE Text11.InteractiveChange
		IF EMPTY(THIS.Value)
		   THISFORM.Limpiar_Datos ()
		ENDIF   
	ENDPROC

	PROCEDURE Text11.Valid
		IF !EMPTY(THIS.Value)
		   IF LEN(ALLTRIM(THIS.Value)) <> 11
		      MESSAGEBOX("No se ha ingreado correctamente el Número de RUC. Verificar !!",48,MSGTITULO)
		      THISFORM.Limpiar_Datos ()
		      RETURN 0
		   ENDIF
		ENDIF
	ENDPROC

	PROCEDURE Text12.InteractiveChange
		IF EMPTY(THIS.Value)
		   THISFORM.Limpiar_Datos ()
		ENDIF   
	ENDPROC

	PROCEDURE Text12.Valid
		IF !EMPTY(THIS.Value)
		   IF LEN(ALLTRIM(THIS.Value)) <> 11
		      MESSAGEBOX("No se ha ingreado correctamente el Número de RUC. Verificar !!",48,MSGTITULO)
		      THISFORM.Limpiar_Datos ()
		      RETURN 0
		   ENDIF
		ENDIF
	ENDPROC

	PROCEDURE Text2.InteractiveChange
		IF EMPTY(THIS.Value)
		   THISFORM.Limpiar_Datos ()
		ENDIF   
	ENDPROC

	PROCEDURE Text2.Valid
		IF !EMPTY(THIS.Value)
		   IF LEN(ALLTRIM(THIS.Value)) <> 11
		      MESSAGEBOX("No se ha ingreado correctamente el Número de RUC. Verificar !!",48,MSGTITULO)
		      THISFORM.Limpiar_Datos ()
		      RETURN 0
		   ENDIF
		ENDIF
	ENDPROC

	PROCEDURE Text3.InteractiveChange
		IF EMPTY(THIS.Value)
		   THISFORM.Limpiar_Datos ()
		ENDIF   
	ENDPROC

	PROCEDURE Text3.Valid
		IF !EMPTY(THIS.Value)
		   IF LEN(ALLTRIM(THIS.Value)) <> 11
		      MESSAGEBOX("No se ha ingreado correctamente el Número de RUC. Verificar !!",48,MSGTITULO)
		      THISFORM.Limpiar_Datos ()
		      RETURN 0
		   ENDIF
		ENDIF
	ENDPROC

	PROCEDURE Text4.InteractiveChange
		IF EMPTY(THIS.Value)
		   THISFORM.Limpiar_Datos ()
		ENDIF   
	ENDPROC

	PROCEDURE Text4.Valid
		IF !EMPTY(THIS.Value)
		   IF LEN(ALLTRIM(THIS.Value)) <> 11
		      MESSAGEBOX("No se ha ingreado correctamente el Número de RUC. Verificar !!",48,MSGTITULO)
		      THISFORM.Limpiar_Datos ()
		      RETURN 0
		   ENDIF
		ENDIF
	ENDPROC

	PROCEDURE Text5.InteractiveChange
		IF EMPTY(THIS.Value)
		   THISFORM.Limpiar_Datos ()
		ENDIF   
	ENDPROC

	PROCEDURE Text5.Valid
		IF !EMPTY(THIS.Value)
		   IF LEN(ALLTRIM(THIS.Value)) <> 11
		      MESSAGEBOX("No se ha ingreado correctamente el Número de RUC. Verificar !!",48,MSGTITULO)
		      THISFORM.Limpiar_Datos ()
		      RETURN 0
		   ENDIF
		ENDIF
	ENDPROC

	PROCEDURE Text6.InteractiveChange
		IF EMPTY(THIS.Value)
		   THISFORM.Limpiar_Datos ()
		ENDIF   
	ENDPROC

	PROCEDURE Text6.Valid
		IF !EMPTY(THIS.Value)
		   IF LEN(ALLTRIM(THIS.Value)) <> 11
		      MESSAGEBOX("No se ha ingreado correctamente el Número de RUC. Verificar !!",48,MSGTITULO)
		      THISFORM.Limpiar_Datos ()
		      RETURN 0
		   ENDIF
		ENDIF
	ENDPROC

	PROCEDURE Text7.InteractiveChange
		IF EMPTY(THIS.Value)
		   THISFORM.Limpiar_Datos ()
		ENDIF   
	ENDPROC

	PROCEDURE Text7.Valid
		IF !EMPTY(THIS.Value)
		   IF LEN(ALLTRIM(THIS.Value)) <> 11
		      MESSAGEBOX("No se ha ingreado correctamente el Número de RUC. Verificar !!",48,MSGTITULO)
		      THISFORM.Limpiar_Datos ()
		      RETURN 0
		   ENDIF
		ENDIF
	ENDPROC

	PROCEDURE Text8.InteractiveChange
		IF EMPTY(THIS.Value)
		   THISFORM.Limpiar_Datos ()
		ENDIF   
	ENDPROC

	PROCEDURE Text8.Valid
		IF !EMPTY(THIS.Value)
		   IF LEN(ALLTRIM(THIS.Value)) <> 11
		      MESSAGEBOX("No se ha ingreado correctamente el Número de RUC. Verificar !!",48,MSGTITULO)
		      THISFORM.Limpiar_Datos ()
		      RETURN 0
		   ENDIF
		ENDIF
	ENDPROC

	PROCEDURE Text9.InteractiveChange
		IF EMPTY(THIS.Value)
		   THISFORM.Limpiar_Datos ()
		ENDIF   
	ENDPROC

	PROCEDURE Text9.Valid
		IF !EMPTY(THIS.Value)
		   IF LEN(ALLTRIM(THIS.Value)) <> 11
		      MESSAGEBOX("No se ha ingreado correctamente el Número de RUC. Verificar !!",48,MSGTITULO)
		      THISFORM.Limpiar_Datos ()
		      RETURN 0
		   ENDIF
		ENDIF
	ENDPROC

	PROCEDURE TxtRuc.InteractiveChange
		IF EMPTY(THIS.Value)
		   THISFORM.Limpiar_Datos ()
		ENDIF   
	ENDPROC

	PROCEDURE TxtRuc.Valid
		If !Empty(This.Value)
			If Len(Alltrim(This.Value)) <> 11
				Messagebox("No se ha ingreado correctamente el Número de RUC. Verificar !!",48,MSGTITULO)
				Thisform.Limpiar_Datos ()
				Return 0
			Endif
		
			If 	!ValidaRuc(This.Value) Then
				Messagebox("N° de RUC No Válido",16,MSGTITULO)
				Thisform.Limpiar_Datos ()
				This.Value = ''
				Return 0
			Endif
		Endif
		
	ENDPROC

ENDDEFINE
