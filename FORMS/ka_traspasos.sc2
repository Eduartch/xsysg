*--------------------------------------------------------------------------------------------------------------------------------------------------------
* (ES) AUTOGENERADO - ¡¡ATENCIÓN!! - ¡¡NO PENSADO PARA EJECUTAR!! USAR SOLAMENTE PARA INTEGRAR CAMBIOS Y ALMACENAR CON HERRAMIENTAS SCM!!
* (EN) AUTOGENERATED - ATTENTION!! - NOT INTENDED FOR EXECUTION!! USE ONLY FOR MERGING CHANGES AND STORING WITH SCM TOOLS!!
*--------------------------------------------------------------------------------------------------------------------------------------------------------
*< FOXBIN2PRG: Version="1.19" SourceFile="ka_traspasos.scx" /> (Solo para binarios VFP 9 / Only for VFP 9 binaries)
*
*
#INCLUDE "..\include\sisfotos.h"

DEFINE CLASS dataenvironment AS dataenvironment 
 	*< CLASSDATA: Baseclass="dataenvironment" Timestamp="" Scale="" Uniqueid="" ClassIcon="1" />

	DataSource = .NULL.
	Height = 620
	Left = 40
	Name = "Dataenvironment"
	Top = 6
	Width = 1016

ENDDEFINE

DEFINE CLASS forventas AS form 
 	*< CLASSDATA: Baseclass="form" Timestamp="" Scale="" Uniqueid="" />

	*-- OBJECTDATA items order determines ZOrder / El orden de los items OBJECTDATA determina el ZOrder 
	*< OBJECTDATA: ObjPath="Container1" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="txtserie" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="txtnumero" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Label9" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="cmdeliminar" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Cmdcerraro" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Cmdaceptar" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Cmdlimpiar" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="txtencontrado" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Cmdotro" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Txtfecha" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="txtitem" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="lbl1" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="lbl2" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Label2" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="txtsucursal1" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="txtsucursal2" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="txtmes" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Label3" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="cmbdcto" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="txtdireccion" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="txtciudad" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="txtpartida" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Label10" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Txtbuscar" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="GRIVTA" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Label1" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="cmbsucursal2" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="txtruc" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="txttotal" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Label12" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="txtalmacen1" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Cmdcopiar" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Cmdpegar" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Cmdexportar" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Cmdotro1" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="txtvalor" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="txtigv" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Cmdanular1" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Cmdimprimir1" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Txtfoco" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Cmdaexcel1" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="lblmenor" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="lblmayor" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="txtstuno" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="txtstdos" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Griart" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Command2" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Cmbsucursal1" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="Gridstocks" UniqueID="" Timestamp="" />

	*<DefinedPropArrayMethod>
		*m: generanumero
		*m: grabar
		*m: grabaresumen
		*m: nuevo
		*m: opcionesc
		*m: retornar
		*m: valida
		*m: verifica
		*p: cbusca		&& Guarda la ultima busqueda realizada
		*p: ct
		*p: fechaautorizada
		*p: idserie
		*p: item		&& Devuelve un miembro determinado de un objeto Collection.
		*p: mensaje
		*p: nauto
		*p: nidg
		*p: nohay
		*p: nreg
		*p: nsgte
		*p: sinstock
		*p: swk
		*p: swp
		*p: swr
		*p: tdoc
		*p: tipo
		*p: transportista
		*p: verdad
	*</DefinedPropArrayMethod>

	AlwaysOnTop = .F.
	AutoCenter = .T.
	BackColor = 192,192,192
	BorderStyle = 1
	BufferMode = 0
	Caption = "[TRASPASOS ENTRE ALMACENES]"
	Closable = .T.
	ControlBox = .T.
	DataSession = 1
	DoCreate = .T.
	fechaautorizada = 0
	FontItalic = .F.
	Height = 531
	Icon = ..\graphics\anular.ico
	idserie = .F.
	item = 		&& Devuelve un miembro determinado de un objeto Collection.
	MaxButton = .F.
	MinButton = .F.
	Movable = .T.
	Name = "FORVENTAS"
	nauto = .F.
	nidg = .F.
	nohay = .F.
	nreg = 0
	nsgte = .F.
	Picture = ..\graphics\appback.jpg
	ShowWindow = 1
	swk = .F.
	swp = .F.
	swr = .F.
	tipo = 1
	Width = 910
	WindowState = 0
	WindowType = 0
	ZoomBox = .F.

	ADD OBJECT 'cmbdcto' AS combobox WITH ;
		FontName = "Tahoma", ;
		FontSize = 8, ;
		Height = 25, ;
		Left = 100, ;
		Name = "cmbdcto", ;
		RowSource = "", ;
		RowSourceType = 6, ;
		SpecialEffect = 1, ;
		Style = 2, ;
		TabIndex = 3, ;
		Top = 32, ;
		Width = 150
		*< END OBJECT: BaseClass="combobox" />

	ADD OBJECT 'Cmbsucursal1' AS cmbalmacen WITH ;
		Enabled = .T., ;
		FontName = "Tahoma", ;
		Height = 24, ;
		Left = 98, ;
		Name = "Cmbsucursal1", ;
		TabIndex = 1, ;
		Top = 5, ;
		Width = 209
		*< END OBJECT: ClassLib="..\libs\sisfotos.vcx" BaseClass="combobox" />

	ADD OBJECT 'cmbsucursal2' AS cmbalmacen WITH ;
		Enabled = .T., ;
		FontName = "Tahoma", ;
		Height = 24, ;
		Left = 679, ;
		Name = "cmbsucursal2", ;
		TabIndex = 2, ;
		Top = 5, ;
		Width = 209
		*< END OBJECT: ClassLib="..\libs\sisfotos.vcx" BaseClass="combobox" />

	ADD OBJECT 'Cmdaceptar' AS cmdaceptar WITH ;
		Caption = "\<Grabar ", ;
		Enabled = .F., ;
		FontName = "Tahoma", ;
		FontSize = 7, ;
		FontUnderline = .F., ;
		Height = 35, ;
		Left = 170, ;
		Name = "Cmdaceptar", ;
		Picture = ..\graphics\save.bmp, ;
		TabIndex = 11, ;
		Top = 456, ;
		Width = 80
		*< END OBJECT: ClassLib="..\libs\sisfotos.vcx" BaseClass="commandbutton" />

	ADD OBJECT 'Cmdaexcel1' AS cmdaexcel WITH ;
		calias = tmpv, ;
		cgriddata = thisform.grivta, ;
		Height = 34, ;
		Left = 407, ;
		Name = "Cmdaexcel1", ;
		TabIndex = 49, ;
		Top = 456, ;
		Width = 78
		*< END OBJECT: ClassLib="..\libs\salidas.vcx" BaseClass="commandbutton" />

	ADD OBJECT 'Cmdanular1' AS cmdanular WITH ;
		Enabled = .T., ;
		FontSize = 7, ;
		Height = 35, ;
		Left = 312, ;
		Name = "Cmdanular1", ;
		TabIndex = 46, ;
		Top = 492, ;
		Visible = .F., ;
		Width = 80
		*< END OBJECT: ClassLib="..\libs\sisfotos.vcx" BaseClass="commandbutton" />

	ADD OBJECT 'Cmdcerraro' AS cmdcerraro WITH ;
		Cancel = .F., ;
		Caption = "\<Retornar ", ;
		FontName = "Tahoma", ;
		FontSize = 7, ;
		FontUnderline = .F., ;
		Height = 35, ;
		Left = 483, ;
		Name = "Cmdcerraro", ;
		TabIndex = 12, ;
		Top = 455, ;
		Width = 80
		*< END OBJECT: ClassLib="..\libs\sisfotos.vcx" BaseClass="commandbutton" />

	ADD OBJECT 'Cmdcopiar' AS cmdcopiar WITH ;
		Height = 29, ;
		Left = 264, ;
		Name = "Cmdcopiar", ;
		TabIndex = 41, ;
		Top = 2, ;
		Visible = .F., ;
		Width = 40
		*< END OBJECT: ClassLib="..\libs\sisven.vcx" BaseClass="commandbutton" />

	ADD OBJECT 'cmdeliminar' AS commandbutton WITH ;
		Caption = "\<Borrar Item", ;
		Enabled = .F., ;
		FontBold = .T., ;
		FontName = "Tahoma", ;
		FontSize = 7, ;
		FontUnderline = .F., ;
		Height = 35, ;
		Left = 89, ;
		Name = "cmdeliminar", ;
		Picture = ..\graphics\borrar.bmp, ;
		TabIndex = 10, ;
		Top = 456, ;
		Width = 80
		*< END OBJECT: BaseClass="commandbutton" />

	ADD OBJECT 'Cmdexportar' AS cmdexportar WITH ;
		Height = 33, ;
		Left = 305, ;
		Name = "Cmdexportar", ;
		TabIndex = 43, ;
		Top = 0, ;
		Visible = .F., ;
		Width = 39
		*< END OBJECT: ClassLib="..\libs\sisven.vcx" BaseClass="commandbutton" />

	ADD OBJECT 'Cmdimprimir1' AS cmdimprimir WITH ;
		FontSize = 7, ;
		Height = 35, ;
		Left = 328, ;
		Name = "Cmdimprimir1", ;
		TabIndex = 47, ;
		Top = 456, ;
		Width = 80
		*< END OBJECT: ClassLib="..\libs\sisfotos.vcx" BaseClass="commandbutton" />

	ADD OBJECT 'Cmdlimpiar' AS cmdlimpiar WITH ;
		Height = 23, ;
		Left = 372, ;
		Name = "Cmdlimpiar", ;
		TabIndex = 14, ;
		Top = 504, ;
		Width = 71
		*< END OBJECT: ClassLib="..\libs\sisfotos.vcx" BaseClass="commandbutton" />

	ADD OBJECT 'Cmdotro' AS cmdotro WITH ;
		FontName = "Tahoma", ;
		FontSize = 7, ;
		FontUnderline = .F., ;
		Height = 35, ;
		Left = 8, ;
		Name = "Cmdotro", ;
		TabIndex = 9, ;
		Top = 456, ;
		Width = 80
		*< END OBJECT: ClassLib="..\libs\sisfotos.vcx" BaseClass="commandbutton" />

	ADD OBJECT 'Cmdotro1' AS cmdotro WITH ;
		FontBold = .T., ;
		FontSize = 7, ;
		Height = 35, ;
		Left = 250, ;
		Name = "Cmdotro1", ;
		TabIndex = 44, ;
		Top = 456, ;
		Width = 80
		*< END OBJECT: ClassLib="..\libs\sisven.vcx" BaseClass="commandbutton" />

	ADD OBJECT 'Cmdpegar' AS cmdpegar WITH ;
		Height = 30, ;
		Left = 340, ;
		Name = "Cmdpegar", ;
		TabIndex = 42, ;
		Top = 2, ;
		Visible = .F., ;
		Width = 44
		*< END OBJECT: ClassLib="..\libs\sisven.vcx" BaseClass="commandbutton" />

	ADD OBJECT 'Command2' AS commandbutton WITH ;
		Caption = "", ;
		Height = 26, ;
		Left = 840, ;
		Name = "Command2", ;
		Picture = ..\graphics\bcs0a.ico, ;
		TabIndex = 45, ;
		Top = 33, ;
		Width = 38
		*< END OBJECT: BaseClass="commandbutton" />

	ADD OBJECT 'Container1' AS container WITH ;
		BackColor = 128,128,128, ;
		BackStyle = 0, ;
		BorderColor = 255,255,255, ;
		ForeColor = 255,255,255, ;
		Height = 69, ;
		Left = 2, ;
		Name = "Container1", ;
		Picture = ..\graphics\appback.jpg, ;
		TabIndex = 7, ;
		Top = 0, ;
		Width = 898
		*< END OBJECT: BaseClass="container" />

	ADD OBJECT 'Griart' AS griart WITH ;
		HeaderHeight = 33, ;
		Height = 323, ;
		Left = 1, ;
		Name = "Griart", ;
		Panel = 1, ;
		TabIndex = 34, ;
		Top = 169, ;
		Visible = .F., ;
		Width = 900, ;
		Column1.ControlSource = "", ;
		Column1.HEADER1.BackColor = 202,202,255, ;
		Column1.HEADER1.ForeColor = 0,0,0, ;
		Column1.HEADER1.Name = "HEADER1", ;
		Column1.Name = "Column1", ;
		Column1.Resizable = .T., ;
		Column1.TEXT1.Name = "TEXT1", ;
		Column1.TEXT1.Visible = .T., ;
		Column1.Visible = .T., ;
		Column1.Width = 334, ;
		Column2.ControlSource = "", ;
		Column2.HEADER1.BackColor = 202,202,255, ;
		Column2.HEADER1.ForeColor = 0,0,0, ;
		Column2.HEADER1.Name = "HEADER1", ;
		Column2.Name = "Column2", ;
		Column2.TEXT1.Name = "TEXT1", ;
		Column2.TEXT1.Visible = .T., ;
		Column2.Visible = .T., ;
		Column3.ControlSource = "", ;
		Column3.HEADER1.BackColor = 202,202,255, ;
		Column3.HEADER1.ForeColor = 0,0,0, ;
		Column3.HEADER1.Name = "HEADER1", ;
		Column3.Name = "Column3", ;
		Column3.TEXT1.Name = "TEXT1", ;
		Column3.TEXT1.Visible = .T., ;
		Column3.Visible = .T., ;
		Column4.ControlSource = "", ;
		Column4.HEADER1.BackColor = 202,202,255, ;
		Column4.HEADER1.ForeColor = 0,0,0, ;
		Column4.HEADER1.Name = "HEADER1", ;
		Column4.Name = "Column4", ;
		Column4.TEXT1.Name = "TEXT1", ;
		Column4.TEXT1.Visible = .T., ;
		Column4.Visible = .T., ;
		Column5.ControlSource = "", ;
		Column5.HEADER1.BackColor = 202,202,255, ;
		Column5.HEADER1.ForeColor = 0,0,0, ;
		Column5.HEADER1.Name = "HEADER1", ;
		Column5.Name = "Column5", ;
		Column5.Resizable = .F., ;
		Column5.TEXT1.Name = "TEXT1", ;
		Column5.TEXT1.Visible = .T., ;
		Column5.Visible = .T., ;
		Column5.Width = 65, ;
		Column6.HEADER1.BackColor = 202,202,255, ;
		Column6.HEADER1.ForeColor = 0,0,0, ;
		Column6.HEADER1.Name = "HEADER1", ;
		Column6.Name = "Column6", ;
		Column6.TEXT1.Name = "TEXT1", ;
		Column6.TEXT1.Visible = .T., ;
		Column6.Visible = .T., ;
		Column6.Width = 68, ;
		Column7.HEADER1.BackColor = 202,202,255, ;
		Column7.HEADER1.ForeColor = 0,0,0, ;
		Column7.HEADER1.Name = "HEADER1", ;
		Column7.Name = "Column7", ;
		Column7.TEXT1.Name = "TEXT1", ;
		Column7.TEXT1.Visible = .T., ;
		Column7.Visible = .T., ;
		Column7.Width = 70, ;
		Column8.HEADER1.BackColor = 202,202,255, ;
		Column8.HEADER1.ForeColor = 0,0,0, ;
		Column8.HEADER1.Name = "HEADER1", ;
		Column8.Name = "Column8", ;
		Column8.TEXT1.Name = "TEXT1", ;
		Column8.TEXT1.Visible = .T., ;
		Column8.Visible = .T., ;
		Column8.Width = 81, ;
		Column9.HEADER1.BackColor = 202,202,255, ;
		Column9.HEADER1.Name = "HEADER1", ;
		Column9.Name = "Column9", ;
		Column9.TEXT1.Name = "TEXT1", ;
		Column9.TEXT1.Visible = .F., ;
		Column9.Visible = .F., ;
		Column9.Width = 65
		*< END OBJECT: ClassLib="..\libs\sisfotos.vcx" BaseClass="grid" />

	ADD OBJECT 'Gridstocks' AS gridstocks WITH ;
		Height = 70, ;
		Left = 684, ;
		Name = "Gridstocks", ;
		Top = 92, ;
		Visible = .F., ;
		Width = 214, ;
		COLUMN1.Header1.Name = "Header1", ;
		COLUMN1.Name = "COLUMN1", ;
		COLUMN1.Text1.Name = "Text1", ;
		COLUMN1.Text1.Visible = .T., ;
		COLUMN1.Visible = .T., ;
		COLUMN1.Width = 86, ;
		COLUMN2.Header1.Name = "Header1", ;
		COLUMN2.Name = "COLUMN2", ;
		COLUMN2.Text1.Name = "Text1", ;
		COLUMN2.Text1.Visible = .T., ;
		COLUMN2.Visible = .T.
		*< END OBJECT: ClassLib="..\libs\sisven.vcx" BaseClass="grid" />

	ADD OBJECT 'GRIVTA' AS grivta WITH ;
		BackColor = 233,233,233, ;
		FontSize = 8, ;
		Height = 371, ;
		Left = 0, ;
		Name = "GRIVTA", ;
		Panel = 1, ;
		RowHeight = 16, ;
		TabIndex = 35, ;
		Top = 72, ;
		Width = 900, ;
		Column1.BackColor = 233,233,233, ;
		Column1.FontSize = 8, ;
		Column1.Header1.BackColor = 196,196,255, ;
		Column1.Header1.FontSize = 8, ;
		Column1.Header1.ForeColor = 0,0,0, ;
		Column1.Header1.Name = "Header1", ;
		Column1.Name = "Column1", ;
		Column1.Text1.BackColor = 233,233,233, ;
		Column1.Text1.FontSize = 8, ;
		Column1.Text1.Name = "Text1", ;
		Column1.Width = 346, ;
		Column2.BackColor = 233,233,233, ;
		Column2.FontSize = 8, ;
		Column2.Header1.BackColor = 196,196,255, ;
		Column2.Header1.FontSize = 8, ;
		Column2.Header1.ForeColor = 0,0,0, ;
		Column2.Header1.Name = "Header1", ;
		Column2.Name = "Column2", ;
		Column2.Text1.BackColor = 233,233,233, ;
		Column2.Text1.FontSize = 8, ;
		Column2.Text1.Name = "Text1", ;
		Column2.Width = 49, ;
		Column3.BackColor = 233,233,233, ;
		Column3.FontSize = 8, ;
		Column3.Header1.BackColor = 196,196,255, ;
		Column3.Header1.FontSize = 8, ;
		Column3.Header1.ForeColor = 0,0,0, ;
		Column3.Header1.Name = "Header1", ;
		Column3.Name = "Column3", ;
		Column3.Text1.BackColor = 233,233,233, ;
		Column3.Text1.FontSize = 8, ;
		Column3.Text1.Name = "Text1", ;
		Column4.BackColor = 233,233,233, ;
		Column4.FontSize = 8, ;
		Column4.Header1.FontSize = 8, ;
		Column4.Header1.Name = "Header1", ;
		Column4.Name = "Column4", ;
		Column4.Text1.BackColor = 233,233,233, ;
		Column4.Text1.FontSize = 8, ;
		Column4.Text1.Name = "Text1", ;
		Column4.Text1.Visible = .T., ;
		Column4.Visible = .T., ;
		Column4.Width = 85, ;
		Column5.BackColor = 233,233,233, ;
		Column5.FontSize = 8, ;
		Column5.Header1.FontSize = 8, ;
		Column5.Header1.Name = "Header1", ;
		Column5.Name = "Column5", ;
		Column5.Text1.BackColor = 233,233,233, ;
		Column5.Text1.FontSize = 8, ;
		Column5.Text1.Name = "Text1", ;
		Column5.Text1.Visible = .T., ;
		Column5.Visible = .T.
		*< END OBJECT: ClassLib="..\libs\sisven.vcx" BaseClass="grid" />

	ADD OBJECT 'Label1' AS label WITH ;
		BackStyle = 0, ;
		BorderStyle = 0, ;
		Caption = "Nº Items:", ;
		FontBold = .T., ;
		FontName = "Tahoma", ;
		FontSize = 8, ;
		ForeColor = 0,0,0, ;
		Height = 13, ;
		Left = 711, ;
		Name = "Label1", ;
		TabIndex = 13, ;
		Top = 490, ;
		Visible = .F., ;
		Width = 52
		*< END OBJECT: BaseClass="label" />

	ADD OBJECT 'Label10' AS label WITH ;
		BackStyle = 0, ;
		Caption = "Localizar:", ;
		FontBold = .T., ;
		FontName = "Tahoma", ;
		FontSize = 8, ;
		FontUnderline = .T., ;
		Height = 15, ;
		Left = 3, ;
		Name = "Label10", ;
		TabIndex = 22, ;
		Top = 491, ;
		Width = 61
		*< END OBJECT: BaseClass="label" />

	ADD OBJECT 'Label12' AS label WITH ;
		BackStyle = 0, ;
		BorderStyle = 0, ;
		Caption = "Total S/.:", ;
		FontBold = .T., ;
		FontName = "Tahoma", ;
		FontSize = 8, ;
		ForeColor = 0,0,0, ;
		Height = 14, ;
		Left = 810, ;
		Name = "Label12", ;
		TabIndex = 39, ;
		Top = 488, ;
		Width = 50
		*< END OBJECT: BaseClass="label" />

	ADD OBJECT 'Label2' AS label WITH ;
		Alignment = 1, ;
		BackColor = 128,128,128, ;
		BackStyle = 0, ;
		Caption = "Número:", ;
		FontBold = .F., ;
		FontName = "Tahoma", ;
		FontSize = 8, ;
		FontUnderline = .T., ;
		ForeColor = 0,0,0, ;
		Height = 12, ;
		Left = 335, ;
		Name = "Label2", ;
		TabIndex = 19, ;
		Top = 38, ;
		Width = 52
		*< END OBJECT: BaseClass="label" />

	ADD OBJECT 'Label3' AS label WITH ;
		BackColor = 128,128,128, ;
		BackStyle = 0, ;
		Caption = "Documento:", ;
		FontBold = .F., ;
		FontName = "Tahoma", ;
		FontSize = 8, ;
		FontUnderline = .T., ;
		ForeColor = 0,0,0, ;
		Height = 13, ;
		Left = 5, ;
		Name = "Label3", ;
		TabIndex = 26, ;
		Top = 38, ;
		Width = 71
		*< END OBJECT: BaseClass="label" />

	ADD OBJECT 'Label9' AS label WITH ;
		BackColor = 128,128,128, ;
		BackStyle = 0, ;
		Caption = "Fecha:", ;
		FontBold = .F., ;
		FontName = "Tahoma", ;
		FontSize = 8, ;
		FontUnderline = .T., ;
		ForeColor = 0,0,0, ;
		Height = 14, ;
		Left = 590, ;
		Name = "Label9", ;
		TabIndex = 8, ;
		Top = 37, ;
		Width = 39
		*< END OBJECT: BaseClass="label" />

	ADD OBJECT 'lbl1' AS label WITH ;
		AutoSize = .T., ;
		BackColor = 128,128,128, ;
		BackStyle = 0, ;
		Caption = "Almacen Origen:", ;
		FontBold = .F., ;
		FontName = "Tahoma", ;
		FontSize = 8, ;
		FontUnderline = .T., ;
		ForeColor = 0,0,0, ;
		Height = 15, ;
		Left = 5, ;
		Name = "lbl1", ;
		TabIndex = 17, ;
		Top = 8, ;
		Width = 81
		*< END OBJECT: BaseClass="label" />

	ADD OBJECT 'lbl2' AS label WITH ;
		AutoSize = .T., ;
		BackColor = 128,128,128, ;
		BackStyle = 0, ;
		Caption = "Almacen Destino:", ;
		FontBold = .F., ;
		FontName = "Tahoma", ;
		FontSize = 8, ;
		FontUnderline = .T., ;
		ForeColor = 0,0,0, ;
		Height = 15, ;
		Left = 590, ;
		Name = "lbl2", ;
		TabIndex = 18, ;
		Top = 10, ;
		Width = 85
		*< END OBJECT: BaseClass="label" />

	ADD OBJECT 'lblmayor' AS label WITH ;
		BackStyle = 0, ;
		Caption = "Stock Tienda:", ;
		FontBold = .T., ;
		FontName = "Tahoma", ;
		FontSize = 8, ;
		FontUnderline = .T., ;
		Height = 15, ;
		Left = 718, ;
		Name = "lblmayor", ;
		TabIndex = 25, ;
		Top = 445, ;
		Width = 76
		*< END OBJECT: BaseClass="label" />

	ADD OBJECT 'lblmenor' AS label WITH ;
		BackStyle = 0, ;
		Caption = "Stock Almacen:", ;
		FontBold = .T., ;
		FontName = "Tahoma", ;
		FontSize = 8, ;
		FontUnderline = .T., ;
		Height = 15, ;
		Left = 718, ;
		Name = "lblmenor", ;
		TabIndex = 24, ;
		Top = 466, ;
		Width = 89
		*< END OBJECT: BaseClass="label" />

	ADD OBJECT 'txtalmacen1' AS textbox WITH ;
		FontName = "Tahoma", ;
		FontSize = 8, ;
		Height = 21, ;
		Left = 264, ;
		Name = "txtalmacen1", ;
		ReadOnly = .T., ;
		TabIndex = 40, ;
		Top = 48, ;
		Visible = .F., ;
		Width = 153
		*< END OBJECT: BaseClass="textbox" />

	ADD OBJECT 'Txtbuscar' AS txtbuscar WITH ;
		FontBold = .T., ;
		FontSize = 8, ;
		Format = "!", ;
		Height = 23, ;
		Left = 2, ;
		Name = "Txtbuscar", ;
		SpecialEffect = 1, ;
		TabIndex = 30, ;
		Top = 506, ;
		Width = 291
		*< END OBJECT: ClassLib="..\libs\sisfotos.vcx" BaseClass="textbox" />

	ADD OBJECT 'txtciudad' AS textbox WITH ;
		Height = 25, ;
		Left = 408, ;
		Name = "txtciudad", ;
		TabIndex = 31, ;
		Top = 492, ;
		Visible = .F., ;
		Width = 73
		*< END OBJECT: BaseClass="textbox" />

	ADD OBJECT 'txtdireccion' AS textbox WITH ;
		Height = 25, ;
		Left = 384, ;
		Name = "txtdireccion", ;
		TabIndex = 27, ;
		Top = 492, ;
		Visible = .F., ;
		Width = 73
		*< END OBJECT: BaseClass="textbox" />

	ADD OBJECT 'txtencontrado' AS textbox WITH ;
		Height = 25, ;
		Left = 432, ;
		MaxLength = 1, ;
		Name = "txtencontrado", ;
		TabIndex = 15, ;
		Top = 504, ;
		Visible = .F., ;
		Width = 37
		*< END OBJECT: BaseClass="textbox" />

	ADD OBJECT 'Txtfecha' AS txtfechar WITH ;
		FontName = "Tahoma", ;
		FontSize = 8, ;
		Height = 24, ;
		Left = 747, ;
		Name = "Txtfecha", ;
		ReadOnly = .T., ;
		SpecialEffect = 1, ;
		TabIndex = 6, ;
		Top = 33, ;
		Width = 90
		*< END OBJECT: ClassLib="..\libs\sisfotos.vcx" BaseClass="textbox" />

	ADD OBJECT 'Txtfoco' AS txtfoco WITH ;
		Left = 480, ;
		Name = "Txtfoco", ;
		TabIndex = 48, ;
		Top = 516
		*< END OBJECT: ClassLib="..\libs\sisven.vcx" BaseClass="textbox" />

	ADD OBJECT 'txtigv' AS textbox WITH ;
		Alignment = 3, ;
		FontBold = .T., ;
		FontName = "Tahoma", ;
		FontSize = 8, ;
		Format = "99,999.99", ;
		Height = 23, ;
		InputMask = "99,999.99", ;
		Left = 624, ;
		Name = "txtigv", ;
		ReadOnly = .T., ;
		SpecialEffect = 1, ;
		TabIndex = 37, ;
		Top = 492, ;
		Value = 0, ;
		Visible = .F., ;
		Width = 92
		*< END OBJECT: BaseClass="textbox" />

	ADD OBJECT 'txtitem' AS textbox WITH ;
		Alignment = 3, ;
		FontBold = .T., ;
		FontName = "Tahoma", ;
		FontSize = 8, ;
		Format = "99", ;
		Height = 23, ;
		InputMask = "99", ;
		Left = 713, ;
		Name = "txtitem", ;
		ReadOnly = .T., ;
		SpecialEffect = 1, ;
		TabIndex = 16, ;
		Top = 504, ;
		Value = 1, ;
		Visible = .T., ;
		Width = 91
		*< END OBJECT: BaseClass="textbox" />

	ADD OBJECT 'txtmes' AS textbox WITH ;
		Alignment = 3, ;
		Height = 25, ;
		Left = 372, ;
		Name = "txtmes", ;
		TabIndex = 23, ;
		Top = 492, ;
		Value = 0, ;
		Visible = .F., ;
		Width = 61
		*< END OBJECT: BaseClass="textbox" />

	ADD OBJECT 'txtnumero' AS textbox WITH ;
		FontName = "Tahoma", ;
		FontSize = 8, ;
		Height = 23, ;
		Left = 435, ;
		MaxLength = 7, ;
		Name = "txtnumero", ;
		SelectOnEntry = .T., ;
		SpecialEffect = 1, ;
		TabIndex = 5, ;
		Top = 34, ;
		Width = 75
		*< END OBJECT: BaseClass="textbox" />

	ADD OBJECT 'txtpartida' AS textbox WITH ;
		Height = 25, ;
		Left = 336, ;
		Name = "txtpartida", ;
		TabIndex = 32, ;
		Top = 492, ;
		Visible = .F., ;
		Width = 85
		*< END OBJECT: BaseClass="textbox" />

	ADD OBJECT 'txtruc' AS textbox WITH ;
		Height = 25, ;
		Left = 384, ;
		Name = "txtruc", ;
		TabIndex = 33, ;
		Top = 504, ;
		Visible = .F., ;
		Width = 85
		*< END OBJECT: BaseClass="textbox" />

	ADD OBJECT 'txtserie' AS textbox WITH ;
		Alignment = 3, ;
		FontName = "Tahoma", ;
		FontSize = 8, ;
		Height = 23, ;
		Left = 391, ;
		MaxLength = 3, ;
		Name = "txtserie", ;
		ReadOnly = .F., ;
		SelectOnEntry = .T., ;
		SpecialEffect = 1, ;
		TabIndex = 4, ;
		Top = 34, ;
		Value = , ;
		Width = 39
		*< END OBJECT: BaseClass="textbox" />

	ADD OBJECT 'txtstdos' AS textbox WITH ;
		Alignment = 3, ;
		FontBold = .T., ;
		FontName = "Tahoma", ;
		FontSize = 8, ;
		Format = "99,999.99", ;
		Height = 21, ;
		InputMask = "99,999.99", ;
		Left = 809, ;
		Name = "txtstdos", ;
		ReadOnly = .T., ;
		SpecialEffect = 1, ;
		TabIndex = 29, ;
		Top = 464, ;
		Value = 0, ;
		Width = 79
		*< END OBJECT: BaseClass="textbox" />

	ADD OBJECT 'txtstuno' AS textbox WITH ;
		Alignment = 3, ;
		FontBold = .T., ;
		FontName = "Tahoma", ;
		FontSize = 8, ;
		Format = "99,999.99", ;
		Height = 20, ;
		InputMask = "99,999.99", ;
		Left = 808, ;
		Name = "txtstuno", ;
		ReadOnly = .T., ;
		SpecialEffect = 1, ;
		TabIndex = 28, ;
		Top = 444, ;
		Value = 0, ;
		Width = 82
		*< END OBJECT: BaseClass="textbox" />

	ADD OBJECT 'txtsucursal1' AS textbox WITH ;
		Height = 23, ;
		Left = 372, ;
		MaxLength = 3, ;
		Name = "txtsucursal1", ;
		TabIndex = 20, ;
		Top = 492, ;
		Visible = .F., ;
		Width = 48
		*< END OBJECT: BaseClass="textbox" />

	ADD OBJECT 'txtsucursal2' AS textbox WITH ;
		Height = 23, ;
		Left = 372, ;
		MaxLength = 3, ;
		Name = "txtsucursal2", ;
		TabIndex = 21, ;
		Top = 492, ;
		Visible = .F., ;
		Width = 48
		*< END OBJECT: BaseClass="textbox" />

	ADD OBJECT 'txttotal' AS textbox WITH ;
		Alignment = 3, ;
		BackColor = 192,192,192, ;
		FontBold = .T., ;
		FontName = "Tahoma", ;
		FontSize = 8, ;
		Format = "999,999.99", ;
		Height = 24, ;
		InputMask = "999,999.99", ;
		Left = 806, ;
		Name = "txttotal", ;
		ReadOnly = .T., ;
		SpecialEffect = 1, ;
		TabIndex = 38, ;
		Top = 504, ;
		Value = 0, ;
		Width = 92
		*< END OBJECT: BaseClass="textbox" />

	ADD OBJECT 'txtvalor' AS textbox WITH ;
		Alignment = 3, ;
		FontBold = .T., ;
		FontName = "Tahoma", ;
		FontSize = 8, ;
		Format = "999,999.99", ;
		Height = 25, ;
		InputMask = "999,999.99", ;
		Left = 528, ;
		Name = "txtvalor", ;
		ReadOnly = .T., ;
		SpecialEffect = 1, ;
		TabIndex = 36, ;
		Top = 492, ;
		Value = 0, ;
		Visible = .F., ;
		Width = 92
		*< END OBJECT: BaseClass="textbox" />
	
	PROCEDURE generanumero
		If Val(Thisform.txtnumero.Value)>=Thisform.nsgte
			If GeneraCorrelativo(Val(Thisform.txtnumero.Value)+1,Thisform.idserie)=0 Then
				Return 0
			Else
				Return 1
			Endif
		Else
			Return 1
		Endif
		
	ENDPROC

	PROCEDURE grabar
		Lparameters ctipo,calmacen,cmodo,nauto
		With Thisform
			ccoda=tmpv.coda
			ncant=tmpv.cant
			nprec=tmpv.Prec
		    ctipo=.ct
			cmone=tmpv.tmon
			cincl="I"
			nidtda=calmacen
			cttip="T"
			cdeta=[TRASPASO INGRESO-SALIDA]
			nidtda1=.txtsucursal2.Value
				IF verificaconexion()=0 then
		RETURN 0
		endif
			If SQLExec(goapp.bdConn,"SELECT FUNINGRESAKARDEX(?nauto,?ccoda,?ctipo,?nprec,?ncant,?cincl,0,?cttip,?cdeta,?nidtda,?nidtda1,0) as nidtr",'Trasp')<1 Then
				errorbd(ERRORPROC+' Kardex ')
				.swk=0
			Else
				If GrabaEntregaFisica(trasp.nidtr,nidtda,ncant,Thisform.nidg)=0
					.swp=0
					Exit
				Endif
				ctipo="C"
				calma1=.txtsucursal2.Value
				calma2=.txtsucursal1.Value
					IF verificaconexion()=0 then
		RETURN 0
		endif
				If SQLExec(goapp.bdConn,"SELECT FUNINGRESAKARDEX(?nauto,?ccoda,?ctipo,?nprec,?ncant,?cincl,0,?cttip,?cdeta,?calma1,?calma2,0) as nidtr") < 1 Then
					errorbd(ERRORPROC+' Kardex ')
					.swk=0
				Endif
			Endif
		Endwith
		If Thisform.swk=0
			Return 0
		Else
			Return 1
		Endif
		
	ENDPROC

	PROCEDURE grabaresumen
		With Thisform
			ctdoc=.tdoc
			cndoc=.txtserie.Value+.txtnumero.Value
			dfecha=.txtfecha.Value
			nv=.txtvalor.Value
			nigv=.txtigv.Value
			nt=.txttotal.Value
			cmvto=Thisform.ct
			cdeta="TRANSFERENCIE ENTRE SUCURSALES"
			nalma2=Thisform.txtsucursal2.Value
			cndo2=Alltrim(Str(.txtsucursal2.Value))
			nidtda=goapp.tienda
			nidusua=goapp.nidusua
			nitem=.txtitem.Value
			nigv1=fe_gene.igv
			If IniciaTransaccion()=0 then
				Thisform.swr=0
				Return
			ENDIF
				IF verificaconexion()=0 then
		RETURN 0
		endif
			If SQLExec(goapp.bdConn,"SELECT FUNINGRESACABECERACV(?ctdoc,'E',?cndoc,?dfecha,?dfecha,?cdeta,?nv,?nigv,?nt,?cndo2,'S',2.80,?nigv1,'T',0,?cmvto,?nidusua,1,?nidtda,0,0,0,?nitem,0) AS NID","NID") < 1
				errorbd(ERRORPROC+' CABECERA')
				Thisform.swr=0
			Else
				Thisform.nauto=nid.nid
				Return 1
			Endif
		Endwith
		
	ENDPROC

	PROCEDURE Init
		Lparameters ctipo
		Thisform.ct=ctipo
		Thisform.grivta.RecordSource=""
		Thisform.griart.RecordSource=""
		Thisform.fechaautorizada=0
		With Thisform
			If MuestraDctos('')=0 Then
				Return .F.
			Endif
			If muestraAlmacenes()=0 Then
				Return .F.
			Endif
			If ctipo="C"
				Thisform.lbl1.Caption="Almacen Ingresa:"
				Thisform.lbl2.Caption="Almacen Viene:"
			Else
				Thisform.txtserie.Value=goapp.serieg
			Endif
			Select nomb,tdoc,idtdoc From dctosv Where tdoc='09' Or tdoc='TT' Into Cursor ldctos Order By tdoc
			Select * From fe_gene Into Cursor config
			.cmbdcto.RowSource="ldctos.nomb"
			.sinstock=""
			nidalma=goapp.tienda
			.swk=1
			.swp=1
			.swr=1
			Select idalma,nomb,Dire,ciud From Almacenes Into Cursor Almacen1
			.cmbsucursal1.RowSource="almacen1.nomb"
			.txtalmacen1.Value=Almacen1.nomb
			.txtsucursal1.Value=goapp.tienda
			.txtpartida.Value=Rtrim(Almacen1.Dire)+' '+Rtrim(Almacen1.ciud)
		****
			Select idalma,nomb,Dire,ciud From Almacenes Into Cursor Almacen2
			.cmbsucursal2.RowSource="almacen2.nomb"
		****
			.tipo=1
			.Caption="Traspasos Entre Almacenes "+Iif(ctipo="V","Salidas","Ingresos")
			.cmbdcto.ListIndex=1
			.cmbsucursal2.ListIndex=1
			.cmbsucursal1.ListIndex=1
			Create Cursor tmpv(coda N(8),Desc c(50),unid c(4),cant N(10,2),Prec N(8,2),;
				dsnc N(3,2),dsnd N(3,2),gast N(3,2),caan N(10,2),alma N(10,2),nreg N(12),ptoll c(60),uno N(10,2),Dos N(10,2),;
				fect d,ndoc c(10),peso N(10,2),Acti c(1),tipro c(1),Valida c(1),marca N(5),linea N(5),tmon c(1),costo N(10,2))
			.grivta.RecordSource="tmpv"
			.grivta.column1.ControlSource="tmpv.desc"
			.grivta.column2.ControlSource="tmpv.unid"
			.grivta.column3.ControlSource="tmpv.cant"
			.grivta.column4.ControlSource="tmpv.prec"
			.grivta.column5.ControlSource="round(tmpv.cant*tmpv.prec,2)"
			.grivta.SetAll("dynamicbackcolor","iif(tmpv.acti='N',RGB(233,233,233),RGB(174,202,210))","Column")
			.grivta.SetAll("dynamicforecolor","iif(tmpv.acti='N',RGB(255,255,255),RGB(0,0,0))","Column")
		Endwith
		
	ENDPROC

	PROCEDURE nuevo
		Zap In TMPV
		With Thisform
			If .txtmes.Value>0
				goapp.mes=.txtmes.Value
			Endif
			.swk=1
			.swp=1
			.swr=1
			.nauto=0
			.txtencontrado.Value=""
			.grivta.column1.ReadOnly=.T.
			.grivta.Refresh
			.cmdlimpiar.Click
			.cmdotro.Enabled=.F.
			.cmbsucursal1.SetFocus
		Endwith
		
	ENDPROC

	PROCEDURE opcionesc
		Lparameters tnBar
		Deactivate Popup GridPopup
		Do Case
		Case tnBar=1
			Thisform.cmdcopiar.Click()
		Case tnBar=2
			Thisform.cmdpegar.Click()
		Case tnBar=3
			Thisform.cmdexportar.Click()
		Endcase
		Return
		
	ENDPROC

	PROCEDURE retornar
		With Thisform
			.grivta.column1.ReadOnly=.T.
			.griDSTOCKS.Visible= .F. 
			.txtbuscar.Visible=.F.
			.cmdcerraro.Enabled=.T.
			.cmdotro.Enabled=.T.
			.cmdeliminar.Enabled=.T.
		Endwith
		
	ENDPROC

	PROCEDURE valida
		Do Case
		Case !esfechavalida(Thisform.txtfecha.Value)
			Thisform.mensaje="Fecha No Válida"
			Return .F.
		Case Thisform.txtencontrado.Value=="V"
			Thisform.mensaje="No Es Posible Actualizar Este Documento"
			Return .F.
		Case Thisform.sinstock="S"
			Thisform.mensaje="Hay Un Item que No Tiene Stock Disponible"
			Return .F.
		Case Empty(tmpv.Desc) Or tmpv.cant=0
			Thisform.mensaje="Ingrese Los Productos"
			Return .F.
		Case Thisform.txtsucursal1.Value=Thisform.txtsucursal2.Value
			Thisform.mensaje="Seleccione Otro Almacen...No se Puede Traspasar a un Mismo Almacen"
			Return .F.
		Case Empty(Thisform.txtnumero.Value) Or Thisform.txtnumero.Value="0000000"
			Thisform.mensaje="Ingrese Un No de Documento Válido"
			Return .F.
		Case (Month(Thisform.txtfecha.Value)<>goapp.mes Or Year(Thisform.txtfecha.Value)<>Val(goapp.año)) And Thisform.fechaautorizada=0
			Thisform.mensaje="Ingrese Una Fecha Permitida Por el Sistema"
			Return .F.
		Otherwise
			Return .T.
		Endcase
		
	ENDPROC

	PROCEDURE verifica
		With Thisform
			.txtbuscar.Visible=.F.
			.griart.Visible=.F.
			.griDSTOCKS.Visible= .F. 
			.cmdcerraro.Enabled=.T.
		Endwith
		
	ENDPROC

	PROCEDURE cmbdcto.GotFocus
		this.BackColor=RGB(255,255,128)
	ENDPROC

	PROCEDURE cmbdcto.LostFocus
		thisform.tdoc=ldctos.tdoc
		this.BackColor=RGB(255,255,255)
	ENDPROC

	PROCEDURE Cmbsucursal1.LostFocus
		With Thisform
			.txtsucursal1.Value=almacen1.idalma
			.txtdireccion.Value=almacen1.Dire
			.txtciudad.Value=almacen1.ciud
		Endwith
		
	ENDPROC

	PROCEDURE cmbsucursal2.LostFocus
		With Thisform
			.txtsucursal2.Value=almacen2.idalma
			.txtdireccion.Value=almacen2.Dire
			.txtciudad.Value=almacen2.ciud
			If .txtsucursal1.Value=.txtsucursal2.Value Then
				Messagebox("No se Puede Traspasar a Almacenes Iguales",16,MSGTITULO)
				Return
			Endif
		Endwith
		
		
	ENDPROC

	PROCEDURE Cmdaceptar.Click
		Local rpta,calma,cpto,dfect,ctipo
		Select tmpv
		Go Top
		If !Thisform.Valida()
			Messagebox(Thisform.mensaje,16,MSGTITULO)
			Return
		Endif
		With Thisform
			If .txtencontrado.Value="V"
				rpta=Messagebox("¿Desea Guardar Los Cambios Efectuados en este Documento?",48+3+0,MSGTITULO)
			Else
				rpta=Messagebox("¿Los Datos de la Venta Son Correctos?",48+3+0,MSGTITULO)
			Endif
			Do Case
				Case rpta=7
					Thisform.nuevo()
					Return
				Case rpta=2
					Thisform.grivta.SetFocus
					Return
			Endcase
			calma=.txtsucursal1.Value
			If Thisform.ct="C"
				ctipo="C"
			Else
				ctipo="V"
			Endif
			If Thisform.ct="V"
				Do Form forftransporte With  Rtrim(.txtdireccion.Value)+' '+Alltrim(.txtciudad.Value) To .transportista
				rpta=Messagebox("¿Desea Imprimir este Documento?",48+3+0,MSGTITULO)
				If rpta=2
					Thisform.grivta.column1.text1.SetFocus
					Return
				Endif
			Endif
			If Thisform.grabaresumen()=0
				Deshacercambios()
				Return
			Endif
			Thisform.nidg=IngresaGuias(Thisform.txtfecha.Value,fe_gene.ptop,'',Thisform.nauto,Thisform.txtfecha.Value,goapp.nidusua,'Entrega Por Despachos-Transferencias',0,'Sin.Guia')
			If Thisform.nidg=0 Then
				Deshacercambios()
				Return
			Endif
			Select tmpv
			Go Top
			Do While !Eof()
				If Empty(tmpv.coda) Or tmpv.coda=0
					Select tmpv
					Skip
					Loop
				Endif
				ccoda=tmpv.coda
				ccant=tmpv.cant
				calma=Thisform.txtsucursal1.Value
				ctipo="V"
				If .grabar(ctipo,calma,"N",.nauto)=0
					Exit
				Else
					If ActualizaStock(ccoda,calma,ccant,ctipo)<0 Then
						.swp=0
						Exit
					Endif
					calma=Thisform.txtsucursal2.Value
					ctipo="C"
					If ActualizaStock(ccoda,calma,ccant,ctipo)<0 Then
						.swp=0
						Exit
					Endif
					If ActualizaStockf(ccoda,calma,ccant,'C')=0 Then
						swp=0
						Exit
					Endif
					If ActualizaStockf(ccoda,calma,ccant,'V')=0 Then
						.swp=0
						Exit
					Endif
				Endif
				Select tmpv
				Skip
			Enddo
			ret=0
			ret=Thisform.Generanumero()
			If Thisform.swp=0 Or Thisform.swk=0 Or Thisform.swr=0 Or ret=0
				Deshacercambios()
				Return
			Endif
			If Thisform.swp=1 And Thisform.swk=1  And Thisform.swr=1 And ret=1
				GrabarCambios()
				If Thisform.ct="V"
					If rpta=6
						Select tmpv
						Replace All ndoc With .txtserie.Value+.txtnumero.Value
						For  x=1 To Thisform.Item -.txtitem.Value
							Insert Into tmpv(ndoc)Values(.txtserie.Value+.txtnumero.Value)
						Endfor
						Go Top In tmpv
						If thisform.tdoc="TT" then 
		     				Report Form traspasos To Printer prompt Noconsole
		     			 Else 
		      				Report Form guiat To Printer prompt Noconsole
		     			EndIf  	
					Endif
				Endif
				.nuevo()
			Endif
		EndWith
	ENDPROC

	PROCEDURE Cmdaexcel1.Click
		this.titulo1="Traspaso:"+ALLTRIM(thisform.txtserie.Value)+thisform.txtnumero.Value
		DODEFAULT()
	ENDPROC

	PROCEDURE Cmdanular1.Click
		With Thisform
			cdocumento=.txtserie.Value+.txtnumero.Value
			If Empty(cdocumento) Or Len(Alltrim(cdocumento))<10
				Messagebox("Se debe Ingresar Serie Y Número Para Poder Anularlo",48,MSGTITULO)
				.txtserie.SetFocus
				Return
			Endif
			Do Form v_verifica With "A" To verdad
			If !verdad
				.txtnumero.SetFocus
				Return
			Endif
			rpta=Messagebox("¿Esta Seguro de Anular este Documento? "+Rtrim(.cmbdcto.Value)+cdocumento,48+3+0,MSGTITULO)
			Do Case
			Case rpta=2
				.txtserie.SetFocus
				Return
			Case rpta=6
				nauto=Thisform.nauto
				cu=goapp.nidusua
				cu1=goapp.uauto
				dfecha=Date()
					IF verificaconexion()=0 then
		RETURN 0
		endif
				If SQLExec(goapp.bdConn,"CALL PROANULATRANSACCIONES(@estado,'','','',?NAUTO,?CU,'',?dfecha,?cu1)") < 1
					errorbd(ERRORPROC)
					Return
				Endif
				goapp.uauto=0
				.nuevo
			Case rpta=7
				.nuevo
				Return
			Endcase
		Endwith
		
	ENDPROC

	PROCEDURE Cmdcerraro.Click
		DODEFAULT()
	ENDPROC

	PROCEDURE cmdeliminar.Click
		Select tmpv
		If Empty(Desc) And Reccount()=1
			Thisform.grivta.column1.text1.SetFocus
			Return
		Endif
		If Eof()
			Thisform.cmdeliminar.Enabled=.F.
			Return
		Endif
		Delete
		With Thisform
			.sinstock="N"
			.txtitem.Value=.txtitem.Value-1
			.cmdotro.Enabled=.T.
			.grivta.Refresh
			.grivta.column1.text1.SetFocus
		Endwith
		
	ENDPROC

	PROCEDURE Cmdexportar.Click
		SELECT desc,unid,cant,prec,cant*prec as importe,coda;
		from tmpv INTO CURSOR aexcel
		this.copiar("aexcel","Venta") 
	ENDPROC

	PROCEDURE Cmdimprimir1.Click
		With Thisform
			Select tmpv
			Replace All ndoc With .txtserie.Value+.txtnumero.Value
			For  x=1 To Thisform.Item -.txtitem.Value
				Insert Into tmpv(ndoc)Values(.txtserie.Value+.txtnumero.Value)
			Endfor
		Endwith
		Select tmpv
		Go Top In tmpv
		If Thisform.tdoc="TT" Then
			Report Form traspasos To Printer Prompt Noconsole
		Else
			Report Form guiat To Printer Prompt Noconsole
		Endif
		Thisform.nuevo()
		
	ENDPROC

	PROCEDURE Cmdlimpiar.Click
		With Thisform
			.txtitem.Value=0
			.txtnumero.Value=""
			.txtencontrado.Value=""
			.cmdaceptar.Enabled=.F.
			.cmdeliminar.Enabled=.F.
			.cmdotro.Enabled=.F.
			.txttotal.Value=0
		Endwith
		
	ENDPROC

	PROCEDURE Cmdotro.Click
		If Thisform.ct="V"
			If Thisform.sinstock="S"
				Messagebox("Hay Un Item Que No Tiene Stock Disponible",16,MSGTITULO)
				Return
			Endif
		Endif
		Sele tmpv
		Loca For Empty(coda)
		If !Found()
		*  if thisform.txtitem.value<thisform.item
			Thisform.verdad=.F.
			Thisform.txtitem.Value=Thisform.txtitem.Value+1
			This.Enabled=.F.
			Thisform.grivta.column1.ReadOnly=.F.
			Appen Blank
			Thisform.grivta.Refresh
			Thisform.nreg=Recno()
			Thisform.grivta.column1.text1.SetFocus
		*   else
		*    messagebox("El Documento ya Contiene el Nº de Items Permitidos se Recomienda Imprmir",48,MSGTITULO)
		*    thisform.grivta.column1.text1.setfocus
		* endif
		Else
			Thisform.grivta.Refresh
			Thisform.grivta.column1.text1.SetFocus
		Endif
		
	ENDPROC

	PROCEDURE Cmdotro1.Click
		thisform.nuevo()
	ENDPROC

	PROCEDURE Command2.Click
		DO FORM v_verifica WITH "A" TO verdad
		IF !verdad 
		   thisform.txtfecha.ReadOnly= .T. 
		   thisform.fechaautorizada=0
		  ELSE 
		   thisform.txtfecha.ReadOnly= .f. 
		   thisform.fechaautorizada=1
		   thisform.txtfecha.SetFocus 
		ENDIF    
		
	ENDPROC

	PROCEDURE Griart.lproductos
		Lparameters nkey
		With Thisform
			Do Case
			Case nkey=7
				.txtbuscar.SetFocus
			Case nkey=13
				Select tmpv
				Go .nreg
				Replace Desc With lproductos.Descri,unid With lproductos.unid,coda With lproductos.idart,costo With lproductos.costo,;
					ndoc With .txtserie.Value+.txtnumero.Value,marca With lproductos.idmar,linea With lproductos.idcat,uno With lproductos.uno,;
					dos With lproductos.Dos,;
					dsnc With 1,dsnd With 1,gast With 1,peso With lproductos.peso,tipro With lproductos.tipro,Prec With lproductos.costo,;
					tmon With lproductos.tmon
				Do Case
				Case Thisform.txtsucursal1.Value=1
					Replace alma With lproductos.uno
				Case Thisform.txtsucursal1.Value=2
					Replace alma With lproductos.Dos
				Case Thisform.txtsucursal1.Value=3
					Replace alma With lproductos.tre
				Case Thisform.txtsucursal1.Value=4
					Replace alma With lproductos.cua
				Endcase
				.retornar()
				.grivta.column3.text1.SetFocus
			Case nkey=27
				.griart.Visible=.F.
				Select tmpv
				Go .nreg
				Delete
				.txtitem.Value=.txtitem.Value-1
				.retornar()
				.grivta.column1.text1.SetFocus
			Endcase
		Endwith
		
	ENDPROC

	PROCEDURE GRIVTA.AfterRowColChange
		LPARAMETERS nColIndex
		thisform.txtstuno.Value=tmpv.uno
		thisform.txtstdos.Value=tmpv.dos
		
	ENDPROC

	PROCEDURE GRIVTA.Column1.Text1.GotFocus
		Select tmpv
		With Thisform
			If Empty(coda)
				.grivta.column1.ReadOnly=.F.
				.cmdotro.Enabled=.F.
			Else
				.grivta.column1.ReadOnly=.T.
				.cmdotro.Enabled=.T.
			Endif
			If .txtitem.Value>=1
				.cmdaceptar.Enabled=.T.
				.cmdeliminar.Enabled=.T.
			Else
				.cmdaceptar.Enabled=.F.
				.cmdeliminar.Enabled=.F.
			Endif
		Endwith
		
	ENDPROC

	PROCEDURE GRIVTA.Column2.Text1.GotFocus
		SELECT tmpv
		DODEFAULT()
	ENDPROC

	PROCEDURE GRIVTA.Column3.Text1.GotFocus
		thisform.verifica()
	ENDPROC

	PROCEDURE GRIVTA.Column3.Text1.KeyPress
		LPARAMETERS nKeyCode, nShiftAltCtrl
		
	ENDPROC

	PROCEDURE GRIVTA.Column3.Text1.LostFocus
		If Thisform.ct="V"
			If tmpv.alma<This.Value
				Messagebox(Alltrim(tmpv.Desc)+" No Disponible "+;
					chr(13)+Chr(10)+" Solo Quedan En Stock: "+Ltrim(Str(alma,10,3)),48+0+0,MSGTITULO)
				Thisform.sinstock="S"
				this.Value=tmpv.alma
				Replace Valida With "S" In tmpv
				thisform.grivta.coluMN2.text1.SetFocus 
				Return 
			Else
				Thisform.sinstock="N"
				Replace Valida With "S" In tmpv
			Endif
		Endif
		Thisform.grivta.suma()
		
	ENDPROC

	PROCEDURE GRIVTA.Column4.Text1.KeyPress
		LPARAMETERS nkeycode,nshiftaltctrl
	ENDPROC

	PROCEDURE GRIVTA.Column4.Text1.LostFocus
		thisform.grivta.suma() 
	ENDPROC

	PROCEDURE GRIVTA.Column5.Text1.KeyPress
		LPARAMETERS nKeyCode, nShiftAltCtrl
		if nkeycode=13
		   if this.value>0
		      thisform.cmdotro.click()
		   endif
		  else
		   thisform.grivta.maneja(nkeycode)
		endif
	ENDPROC

	PROCEDURE GRIVTA.suma
		Select tmpv
		If Reccount()>0
			r=Recno()
		Endif
		With Thisform
			Sum Round(cant*Prec,2) To .txttotal.Value
			.txtvalor.Value=Round(.txttotal.Value/config.igv,2)
			.txtigv.Value=Round(.txttotal.Value-.txtvalor.Value,2)
		Endwith
		If r>0
			Go r
		Endif
		
	ENDPROC

	PROCEDURE Txtbuscar.LostFocus
		DODEFAULT()
	ENDPROC

	PROCEDURE Txtfecha.GotFocus
		this.BackColor=RGB(255,255,128)
		if thisform.txtnumero.value="0000000"
		   thisform.txtserie.setfocus
		   RETURN 
		ENDIF 
	ENDPROC

	PROCEDURE Txtfecha.LostFocus
		This.BackColor=Rgb(255,255,255)
		This.ReadOnly= .T.
		Sele tmpv
		If !Empty(Thisform.txtserie.Value) Or !Empty(Thisform.txtnumero.Value)
			Go Top
			If Bof() And Eof()
				Append Blank
				Thisform.nreg=Recno()
				Thisform.txtitem.Value=1
			Endif
			Thisform.grivta.column1.text1.SetFocus
		Else
			Thisform.txtserie.SetFocus
		Endif
		
	ENDPROC

	PROCEDURE txtnumero.GotFocus
		this.BackColor=RGB(255,255,128)
		IF LEN(alltrim(thisform.txtserie.value))<3
		   thisform.txtserie.setfocus
		   RETURN 
		ENDIF
	ENDPROC

	PROCEDURE txtnumero.LostFocus
		Local rep
		This.BackColor=Rgb(255,255,255)
		This.Value=Right("000000"+Alltrim(This.Value),7)
		cdo=Thisform.txtserie.Value+This.Value
		ctdoc=Thisform.tdoc
		cmvto=Iif(Thisform.ct="C","C","V")
		talmacen=0
		TEXT TO lcConsulta NOSHOW
		     SELECT a.alma,a.idkar,b.descri,b.unid,a.idart,a.cant,a.prec,c.impo,c.valor,c.igv,
		     c.fech,a.tipo,c.tdoc,c.ndoc,c.mone,c.idauto FROM fe_kar as a inner JOIN  fe_art as b
		     ON (b.idart=a.idart) inner join fe_rcom as c ON(c.idauto=a.idauto)
		     WHERE c.ndoc=?cdo and c.tdoc=?ctdoc and a.tipo=?cmvto AND c.ACTI<>'I'
		ENDTEXT
			IF verificaconexion()=0 then
		RETURN 0
		endif
		If SQLExec(goapp.bdConn, lcconsulta, "kardex") < 1
			errorbd(lcconsulta)
			Return
		Else
			If regdvto("kardex")>0 And Thisform.txtencontrado.Value="V"
				Thisform.nuevo()
				Return
			Endif
		Endif
		x=1
		With Thisform
			Select kardex
			Do While !Eof()
				If x=1
					Delete From tmpv Where Empty(coda)
					.txtitem.Value=0
					Do Form v_verifica With "V" To verdad
					If !verdad
						.txtencontrado.Value="X"
						Exit
					Else
						goapp.mes=Month(kardex.fech)
					Endif
					.txtencontrado.Value="V"
					.txtfecha.Value=kardex.fech
					.nauto=kardex.idauto
					.txttotal.Value=kardex.Impo
					.txtvalor.Value=kardex.igv
					.txtigv.Value=kardex.igv
				Endif
				x=x+1
				Insert Into tmpv(coda,Desc,unid,cant,Prec,nreg,alma,ndoc);
					values(kardex.idart,kardex.Descri,kardex.unid,kardex.cant,kardex.Prec,kardex.idkar,;
					kardex.cant+talmacen,.txtserie.Value+.txtnumero.Value)
				.txtitem.Value=.txtitem.Value+1
				Select kardex
				Skip
			Enddo
			Do Case
			Case .txtencontrado.Value="V"
				.grivta.column1.ReadOnly=.T.
				.grivta.Refresh
				.cmdaceptar.Enabled=.T.
				.cmdotro.Enabled=.T.
				.txtfecha.SetFocus
			Case .txtencontrado.Value="X"
				.txtencontrado.Value=""
				.cmdlimpiar.Click
				.cmbsucursal2.SetFocus
				Return
			Otherwise
				.grivta.column1.ReadOnly=.F.
				.txtfecha.SetFocus
			Endcase
		Endwith
		
	ENDPROC

	PROCEDURE txtserie.GotFocus
		this.BackColor=RGB(255,255,128)
	ENDPROC

	PROCEDURE txtserie.LostFocus
		This.BackColor=Rgb(255,255,255)
		This.Value=Right("000"+Alltrim(This.Value),3)
		If Thisform.tipo=1
			If BuscarSeries(Val(This.Value),Thisform.tdoc)=0 Then
				This.Value=""
				Thisform.txtnumero.Value=""
				Thisform.cmbdcto.SetFocus
				Return
			Else
				Thisform.txtnumero.Value=Alltrim(Str(series.nume))
				Thisform.Item=series.items
				Thisform.nsgte=series.nume
				Thisform.idserie=series.idserie
			Endif
		EndIf
		
	ENDPROC

ENDDEFINE
